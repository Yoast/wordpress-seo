!function(){"use strict";var e=function(){YoastSEO.app.registerPlugin("YoastShortcodePlugin",{status:"loading"}),this.bindElementEvents();var e="("+wpseoShortcodePluginL10n.wpseo_shortcode_tags.join("|")+")";this.keywordRegex=new RegExp(e,"g"),this.closingTagRegex=new RegExp("\\[\\/"+e+"\\]","g"),this.nonCaptureRegex=new RegExp("\\["+e+"[^\\]]*?\\]","g"),this.parsedShortcodes=[],this.loadShortcodes(this.declareReady.bind(this))};e.prototype.declareReady=function(){YoastSEO.app.pluginReady("YoastShortcodePlugin"),this.registerModifications()},e.prototype.declareReloaded=function(){YoastSEO.app.pluginReloaded("YoastShortcodePlugin")},e.prototype.registerModifications=function(){YoastSEO.app.registerModification("content",this.replaceShortcodes.bind(this),"YoastShortcodePlugin")},e.prototype.replaceShortcodes=function(e){var t=this.parsedShortcodes;if("string"==typeof e&&t.length>0)for(var o in t)e=e.replace(t[o].shortcode,t[o].output);return e},e.prototype.loadShortcodes=function(e){var t=this.getUnparsedShortcodes(this.getShortcodes(this.getContentTinyMCE()));t.length>0?this.parseShortcodes(t,e):e()},e.prototype.bindElementEvents=function(){var e=document.getElementById("content");null!==e&&(e.addEventListener("keydown",this.loadShortcodes.bind(this,this.declareReloaded.bind(this))),e.addEventListener("change",this.loadShortcodes.bind(this,this.declareReloaded.bind(this))));var t=this;"undefined"!=typeof tinyMCE&&"function"==typeof tinyMCE.on&&tinyMCE.on("addEditor",function(e){e.editor.on("change",function(){t.loadShortcodes.bind(t,t.declareReloaded.bind(t))()}),e.editor.on("keydown",function(){t.loadShortcodes.bind(t,t.declareReloaded.bind(t))()})})},e.prototype.getContentTinyMCE=function(){var e=document.getElementById("content"),t="";return null!==e&&(t=e.value),"undefined"!=typeof tinyMCE&&"undefined"!=typeof tinyMCE.editors&&0!==tinyMCE.editors.length&&(t=tinyMCE.get("content").getContent()),t},e.prototype.getUnparsedShortcodes=function(e){if("object"!=typeof e)return console.error("Failed to get unparsed shortcodes. Expected parameter to be an array, instead received "+typeof e),!1;var t=[];for(var o in e){var n=e[o];-1===t.indexOf(n)&&this.isUnparsedShortcode(n)&&t.push(n)}return t},e.prototype.isUnparsedShortcode=function(e){var t=!1;for(var o in this.parsedShortcodes)this.parsedShortcodes[o].shortcode===e&&(t=!0);return t===!1},e.prototype.getShortcodes=function(e){if("string"!=typeof e)return console.error("Failed to get shortcodes. Expected parameter to be a string, instead received"+typeof e),!1;var t=this.matchCapturingShortcodes(e);for(var o in t)e=e.replace(t[o],"");var n=this.matchNonCapturingShortcodes(e);return t.concat(n)},e.prototype.matchCapturingShortcodes=function(e){var t=[],o=(e.match(this.closingTagRegex)||[]).join(" ").match(this.keywordRegex)||[];for(var n in o){var r=o[n],i="\\["+r+"[^\\]]*?\\].*?\\[\\/"+r+"\\]",d=e.match(new RegExp(i,"g"))||[];t=t.concat(d)}return t},e.prototype.matchNonCapturingShortcodes=function(e){return e.match(this.nonCaptureRegex)||[]},e.prototype.parseShortcodes=function(e,t){return"function"!=typeof t?(console.error("Failed to parse shortcodes. Expected parameter to be a function, instead received "+typeof t),!1):void("object"==typeof e&&e.length>0?jQuery.get(ajaxurl,{action:"wpseo_filter_shortcodes",_wpnonce:wpseoShortcodePluginL10n.wpseo_filter_shortcodes_nonce,data:e},function(e){this.saveParsedShortcodes(e,t)}.bind(this)):t())},e.prototype.saveParsedShortcodes=function(e,t){e=JSON.parse(e);for(var o in e)this.parsedShortcodes.push(e[o]);t()},window.YoastShortcodePlugin=e}();