(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

/* global wp, _, wpseoPrimaryCategoryL10n */
(function ($) {
	"use strict";

	var primaryTermInputTemplate, primaryTermUITemplate, primaryTermScreenReaderTemplate;
	var taxonomies = wpseoPrimaryCategoryL10n.taxonomies;

	/**
  * Checks if the elements to make a term the primary term and the display for a primary term exist
  *
  * @param {Object} checkbox
  *
  * @returns {boolean}
  */
	function hasPrimaryTermElements(checkbox) {
		return 1 === $(checkbox).closest("li").children(".wpseo-make-primary-term").length;
	}

	/**
  * Retrieves the primary term for a taxonomy
  *
  * @param {string} taxonomyName
  * @returns {string}
  */
	function getPrimaryTerm(taxonomyName) {
		var primaryTermInput;

		primaryTermInput = $("#yoast-wpseo-primary-" + taxonomyName);
		return primaryTermInput.val();
	}

	/**
  * Sets the primary term for a taxonomy
  *
  * @param {string} taxonomyName
  * @param {string} termId
  *
  * @returns {void}
  */
	function setPrimaryTerm(taxonomyName, termId) {
		var primaryTermInput;

		primaryTermInput = $("#yoast-wpseo-primary-" + taxonomyName);
		primaryTermInput.val(termId).trigger("change");
	}

	/**
  * Creates the elements necessary to show something is a primary term or to make it the primary term
  *
  * @param {string} taxonomyName
  * @param {Object} checkbox
  *
  * @returns {void}
  */
	function createPrimaryTermElements(taxonomyName, checkbox) {
		var label, html;

		label = $(checkbox).closest("label");

		html = primaryTermUITemplate({
			taxonomy: taxonomies[taxonomyName],
			term: label.text()
		});

		label.after(html);
	}

	/**
  * Updates the primary term selectors/indicators for a certain taxonomy
  *
  * @param {string} taxonomyName
  *
  * @returns {void}
  */
	function updatePrimaryTermSelectors(taxonomyName) {
		var checkedTerms, uncheckedTerms;
		var listItem, label;

		checkedTerms = $("#" + taxonomyName + 'checklist input[type="checkbox"]:checked');
		uncheckedTerms = $("#" + taxonomyName + 'checklist input[type="checkbox"]:not(:checked)');

		// Remove all classes for a consistent experience
		checkedTerms.add(uncheckedTerms).closest("li").removeClass("wpseo-term-unchecked").removeClass("wpseo-primary-term").removeClass("wpseo-non-primary-term");

		$(".wpseo-primary-category-label").remove();

		// If there is only one term selected we don't want to show our interface.
		if (checkedTerms.length <= 1) {
			checkedTerms.add(uncheckedTerms).closest("li").addClass("wpseo-term-unchecked");
			return;
		}

		checkedTerms.each(function (i, term) {
			term = $(term);
			listItem = term.closest("li");

			// Create our interface elements if they don't exist.
			if (!hasPrimaryTermElements(term)) {
				createPrimaryTermElements(taxonomyName, term);
			}

			if (term.val() === getPrimaryTerm(taxonomyName)) {
				listItem.addClass("wpseo-primary-term");

				label = term.closest("label");
				label.find(".wpseo-primary-category-label").remove();
				label.append(primaryTermScreenReaderTemplate({
					taxonomy: taxonomies[taxonomyName]
				}));
			} else {
				listItem.addClass("wpseo-non-primary-term");
			}
		});

		// Hide our interface elements on all unchecked checkboxes.
		uncheckedTerms.closest("li").addClass("wpseo-term-unchecked");
	}

	/**
  * Makes the first term primary for a certain taxonomy
  *
  * @param {string} taxonomyName
  *
  * @returns {void}
  */
	function makeFirstTermPrimary(taxonomyName) {
		var firstTerm = $("#" + taxonomyName + 'checklist input[type="checkbox"]:checked:first');

		setPrimaryTerm(taxonomyName, firstTerm.val());
		updatePrimaryTermSelectors(taxonomyName);
	}

	/**
  * If we check a term while there is no primary term we make that one the primary term.
  *
  * @param {string} taxonomyName
  *
  * @returns {void}
  */
	function ensurePrimaryTerm(taxonomyName) {
		if ("" === getPrimaryTerm(taxonomyName)) {
			makeFirstTermPrimary(taxonomyName);
		}
	}

	/**
  * Returns the term checkbox handler for a certain taxonomy name
  *
  * @param {string} taxonomyName
  * @returns {Function}
  */
	function termCheckboxHandler(taxonomyName) {
		return function () {
			// If the user unchecks the primary category we have to select any new primary term
			if (false === $(this).prop("checked") && $(this).val() === getPrimaryTerm(taxonomyName)) {
				makeFirstTermPrimary(taxonomyName);
			}

			ensurePrimaryTerm(taxonomyName);

			updatePrimaryTermSelectors(taxonomyName);
		};
	}

	/**
  * Returns the term list add handler for a certain taxonomy name
  *
  * @param {string} taxonomyName
  * @returns {Function}
  */
	function termListAddHandler(taxonomyName) {
		return function () {
			ensurePrimaryTerm(taxonomyName);
			updatePrimaryTermSelectors(taxonomyName);
		};
	}

	/**
  * Returns the make primary event handler for a certain taxonomy name
  *
  * @param {string} taxonomyName
  * @returns {Function}
  */
	function makePrimaryHandler(taxonomyName) {
		return function (e) {
			var term, checkbox;

			term = $(e.currentTarget);
			checkbox = term.siblings("label").find("input");

			setPrimaryTerm(taxonomyName, checkbox.val());

			updatePrimaryTermSelectors(taxonomyName);

			// The clicked link will be hidden so we need to focus something different.
			checkbox.focus();
		};
	}

	$.fn.initYstSEOPrimaryCategory = function () {
		return this.each(function (i, taxonomy) {
			var metaboxTaxonomy, html;

			metaboxTaxonomy = $("#" + taxonomy.name + "div");

			html = primaryTermInputTemplate({
				taxonomy: taxonomy
			});

			metaboxTaxonomy.append(html);

			updatePrimaryTermSelectors(taxonomy.name);

			metaboxTaxonomy.on("click", 'input[type="checkbox"]', termCheckboxHandler(taxonomy.name));

			// When the AJAX Request is done, this event will be fired.
			metaboxTaxonomy.on("wpListAddEnd", "#" + taxonomy.name + "checklist", termListAddHandler(taxonomy.name));

			metaboxTaxonomy.on("click", ".wpseo-make-primary-term", makePrimaryHandler(taxonomy.name));
		});
	};

	$(function () {
		// Initialize our templates
		primaryTermInputTemplate = wp.template("primary-term-input");
		primaryTermUITemplate = wp.template("primary-term-ui");
		primaryTermScreenReaderTemplate = wp.template("primary-term-screen-reader");

		$(_.values(taxonomies)).initYstSEOPrimaryCategory();
	});
})(jQuery);

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9zcmMvd3Atc2VvLW1ldGFib3gtY2F0ZWdvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBO0FBQ0UsV0FBVSxDQUFWLEVBQWM7QUFDZjs7QUFFQSxLQUFJLHdCQUFKLEVBQThCLHFCQUE5QixFQUFxRCwrQkFBckQ7QUFDQSxLQUFJLGFBQWEseUJBQXlCLFVBQTFDOztBQUVBOzs7Ozs7O0FBT0EsVUFBUyxzQkFBVCxDQUFpQyxRQUFqQyxFQUE0QztBQUMzQyxTQUFPLE1BQU0sRUFBRyxRQUFILEVBQWMsT0FBZCxDQUF1QixJQUF2QixFQUE4QixRQUE5QixDQUF3QywwQkFBeEMsRUFBcUUsTUFBbEY7QUFDQTs7QUFFRDs7Ozs7O0FBTUEsVUFBUyxjQUFULENBQXlCLFlBQXpCLEVBQXdDO0FBQ3ZDLE1BQUksZ0JBQUo7O0FBRUEscUJBQW1CLEVBQUcsMEJBQTBCLFlBQTdCLENBQW5CO0FBQ0EsU0FBTyxpQkFBaUIsR0FBakIsRUFBUDtBQUNBOztBQUVEOzs7Ozs7OztBQVFBLFVBQVMsY0FBVCxDQUF5QixZQUF6QixFQUF1QyxNQUF2QyxFQUFnRDtBQUMvQyxNQUFJLGdCQUFKOztBQUVBLHFCQUFtQixFQUFHLDBCQUEwQixZQUE3QixDQUFuQjtBQUNBLG1CQUFpQixHQUFqQixDQUFzQixNQUF0QixFQUErQixPQUEvQixDQUF3QyxRQUF4QztBQUNBOztBQUVEOzs7Ozs7OztBQVFBLFVBQVMseUJBQVQsQ0FBb0MsWUFBcEMsRUFBa0QsUUFBbEQsRUFBNkQ7QUFDNUQsTUFBSSxLQUFKLEVBQVcsSUFBWDs7QUFFQSxVQUFRLEVBQUcsUUFBSCxFQUFjLE9BQWQsQ0FBdUIsT0FBdkIsQ0FBUjs7QUFFQSxTQUFPLHNCQUF1QjtBQUM3QixhQUFVLFdBQVksWUFBWixDQURtQjtBQUU3QixTQUFNLE1BQU0sSUFBTjtBQUZ1QixHQUF2QixDQUFQOztBQUtBLFFBQU0sS0FB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QyxNQXpPRCxDQUFGIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qIGdsb2JhbCB3cCwgXywgd3BzZW9QcmltYXJ5Q2F0ZWdvcnlMMTBuICovXG4oIGZ1bmN0aW9uKCAkICkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHR2YXIgcHJpbWFyeVRlcm1JbnB1dFRlbXBsYXRlLCBwcmltYXJ5VGVybVVJVGVtcGxhdGUsIHByaW1hcnlUZXJtU2NyZWVuUmVhZGVyVGVtcGxhdGU7XG5cdHZhciB0YXhvbm9taWVzID0gd3BzZW9QcmltYXJ5Q2F0ZWdvcnlMMTBuLnRheG9ub21pZXM7XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgZWxlbWVudHMgdG8gbWFrZSBhIHRlcm0gdGhlIHByaW1hcnkgdGVybSBhbmQgdGhlIGRpc3BsYXkgZm9yIGEgcHJpbWFyeSB0ZXJtIGV4aXN0XG5cdCAqXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBjaGVja2JveFxuXHQgKlxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cblx0ICovXG5cdGZ1bmN0aW9uIGhhc1ByaW1hcnlUZXJtRWxlbWVudHMoIGNoZWNrYm94ICkge1xuXHRcdHJldHVybiAxID09PSAkKCBjaGVja2JveCApLmNsb3Nlc3QoIFwibGlcIiApLmNoaWxkcmVuKCBcIi53cHNlby1tYWtlLXByaW1hcnktdGVybVwiICkubGVuZ3RoO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHJpZXZlcyB0aGUgcHJpbWFyeSB0ZXJtIGZvciBhIHRheG9ub215XG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0YXhvbm9teU5hbWVcblx0ICogQHJldHVybnMge3N0cmluZ31cblx0ICovXG5cdGZ1bmN0aW9uIGdldFByaW1hcnlUZXJtKCB0YXhvbm9teU5hbWUgKSB7XG5cdFx0dmFyIHByaW1hcnlUZXJtSW5wdXQ7XG5cblx0XHRwcmltYXJ5VGVybUlucHV0ID0gJCggXCIjeW9hc3Qtd3BzZW8tcHJpbWFyeS1cIiArIHRheG9ub215TmFtZSApO1xuXHRcdHJldHVybiBwcmltYXJ5VGVybUlucHV0LnZhbCgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldHMgdGhlIHByaW1hcnkgdGVybSBmb3IgYSB0YXhvbm9teVxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdGF4b25vbXlOYW1lXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0ZXJtSWRcblx0ICpcblx0ICogQHJldHVybnMge3ZvaWR9XG5cdCAqL1xuXHRmdW5jdGlvbiBzZXRQcmltYXJ5VGVybSggdGF4b25vbXlOYW1lLCB0ZXJtSWQgKSB7XG5cdFx0dmFyIHByaW1hcnlUZXJtSW5wdXQ7XG5cblx0XHRwcmltYXJ5VGVybUlucHV0ID0gJCggXCIjeW9hc3Qtd3BzZW8tcHJpbWFyeS1cIiArIHRheG9ub215TmFtZSApO1xuXHRcdHByaW1hcnlUZXJtSW5wdXQudmFsKCB0ZXJtSWQgKS50cmlnZ2VyKCBcImNoYW5nZVwiICk7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyB0aGUgZWxlbWVudHMgbmVjZXNzYXJ5IHRvIHNob3cgc29tZXRoaW5nIGlzIGEgcHJpbWFyeSB0ZXJtIG9yIHRvIG1ha2UgaXQgdGhlIHByaW1hcnkgdGVybVxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdGF4b25vbXlOYW1lXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBjaGVja2JveFxuXHQgKlxuXHQgKiBAcmV0dXJucyB7dm9pZH1cblx0ICovXG5cdGZ1bmN0aW9uIGNyZWF0ZVByaW1hcnlUZXJtRWxlbWVudHMoIHRheG9ub215TmFtZSwgY2hlY2tib3ggKSB7XG5cdFx0dmFyIGxhYmVsLCBodG1sO1xuXG5cdFx0bGFiZWwgPSAkKCBjaGVja2JveCApLmNsb3Nlc3QoIFwibGFiZWxcIiApO1xuXG5cdFx0aHRtbCA9IHByaW1hcnlUZXJtVUlUZW1wbGF0ZSgge1xuXHRcdFx0dGF4b25vbXk6IHRheG9ub21pZXNbIHRheG9ub215TmFtZSBdLFxuXHRcdFx0dGVybTogbGFiZWwudGV4dCgpLFxuXHRcdH0gKTtcblxuXHRcdGxhYmVsLmFmdGVyKCBodG1sICk7XG5cdH1cblxuXHQvKipcblx0ICogVXBkYXRlcyB0aGUgcHJpbWFyeSB0ZXJtIHNlbGVjdG9ycy9pbmRpY2F0b3JzIGZvciBhIGNlcnRhaW4gdGF4b25vbXlcblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IHRheG9ub215TmFtZVxuXHQgKlxuXHQgKiBAcmV0dXJucyB7dm9pZH1cblx0ICovXG5cdGZ1bmN0aW9uIHVwZGF0ZVByaW1hcnlUZXJtU2VsZWN0b3JzKCB0YXhvbm9teU5hbWUgKSB7XG5cdFx0dmFyIGNoZWNrZWRUZXJtcywgdW5jaGVja2VkVGVybXM7XG5cdFx0dmFyIGxpc3RJdGVtLCBsYWJlbDtcblxuXHRcdGNoZWNrZWRUZXJtcyA9ICQoIFwiI1wiICsgdGF4b25vbXlOYW1lICsgJ2NoZWNrbGlzdCBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcgKTtcblx0XHR1bmNoZWNrZWRUZXJtcyA9ICQoIFwiI1wiICsgdGF4b25vbXlOYW1lICsgJ2NoZWNrbGlzdCBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06bm90KDpjaGVja2VkKScgKTtcblxuXHRcdC8vIFJlbW92ZSBhbGwgY2xhc3NlcyBmb3IgYSBjb25zaXN0ZW50IGV4cGVyaWVuY2Vcblx0XHRjaGVja2VkVGVybXMuYWRkKCB1bmNoZWNrZWRUZXJtcyApLmNsb3Nlc3QoIFwibGlcIiApXG5cdFx0XHQucmVtb3ZlQ2xhc3MoIFwid3BzZW8tdGVybS11bmNoZWNrZWRcIiApXG5cdFx0XHQucmVtb3ZlQ2xhc3MoIFwid3BzZW8tcHJpbWFyeS10ZXJtXCIgKVxuXHRcdFx0LnJlbW92ZUNsYXNzKCBcIndwc2VvLW5vbi1wcmltYXJ5LXRlcm1cIiApO1xuXG5cdFx0JCggXCIud3BzZW8tcHJpbWFyeS1jYXRlZ29yeS1sYWJlbFwiICkucmVtb3ZlKCk7XG5cblx0XHQvLyBJZiB0aGVyZSBpcyBvbmx5IG9uZSB0ZXJtIHNlbGVjdGVkIHdlIGRvbid0IHdhbnQgdG8gc2hvdyBvdXIgaW50ZXJmYWNlLlxuXHRcdGlmICggY2hlY2tlZFRlcm1zLmxlbmd0aCA8PSAxICkge1xuXHRcdFx0Y2hlY2tlZFRlcm1zLmFkZCggdW5jaGVja2VkVGVybXMgKS5jbG9zZXN0KCBcImxpXCIgKS5hZGRDbGFzcyggXCJ3cHNlby10ZXJtLXVuY2hlY2tlZFwiICk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y2hlY2tlZFRlcm1zLmVhY2goIGZ1bmN0aW9uKCBpLCB0ZXJtICkge1xuXHRcdFx0dGVybSA9ICQoIHRlcm0gKTtcblx0XHRcdGxpc3RJdGVtID0gdGVybS5jbG9zZXN0KCBcImxpXCIgKTtcblxuXHRcdFx0Ly8gQ3JlYXRlIG91ciBpbnRlcmZhY2UgZWxlbWVudHMgaWYgdGhleSBkb24ndCBleGlzdC5cblx0XHRcdGlmICggISBoYXNQcmltYXJ5VGVybUVsZW1lbnRzKCB0ZXJtICkgKSB7XG5cdFx0XHRcdGNyZWF0ZVByaW1hcnlUZXJtRWxlbWVudHMoIHRheG9ub215TmFtZSwgdGVybSApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIHRlcm0udmFsKCkgPT09IGdldFByaW1hcnlUZXJtKCB0YXhvbm9teU5hbWUgKSApIHtcblx0XHRcdFx0bGlzdEl0ZW0uYWRkQ2xhc3MoIFwid3BzZW8tcHJpbWFyeS10ZXJtXCIgKTtcblxuXHRcdFx0XHRsYWJlbCA9IHRlcm0uY2xvc2VzdCggXCJsYWJlbFwiICk7XG5cdFx0XHRcdGxhYmVsLmZpbmQoIFwiLndwc2VvLXByaW1hcnktY2F0ZWdvcnktbGFiZWxcIiApLnJlbW92ZSgpO1xuXHRcdFx0XHRsYWJlbC5hcHBlbmQoIHByaW1hcnlUZXJtU2NyZWVuUmVhZGVyVGVtcGxhdGUoIHtcblx0XHRcdFx0XHR0YXhvbm9teTogdGF4b25vbWllc1sgdGF4b25vbXlOYW1lIF0sXG5cdFx0XHRcdH0gKSApO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGxpc3RJdGVtLmFkZENsYXNzKCBcIndwc2VvLW5vbi1wcmltYXJ5LXRlcm1cIiApO1xuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdC8vIEhpZGUgb3VyIGludGVyZmFjZSBlbGVtZW50cyBvbiBhbGwgdW5jaGVja2VkIGNoZWNrYm94ZXMuXG5cdFx0dW5jaGVja2VkVGVybXMuY2xvc2VzdCggXCJsaVwiICkuYWRkQ2xhc3MoIFwid3BzZW8tdGVybS11bmNoZWNrZWRcIiApO1xuXHR9XG5cblx0LyoqXG5cdCAqIE1ha2VzIHRoZSBmaXJzdCB0ZXJtIHByaW1hcnkgZm9yIGEgY2VydGFpbiB0YXhvbm9teVxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdGF4b25vbXlOYW1lXG5cdCAqXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxuXHQgKi9cblx0ZnVuY3Rpb24gbWFrZUZpcnN0VGVybVByaW1hcnkoIHRheG9ub215TmFtZSApIHtcblx0XHR2YXIgZmlyc3RUZXJtID0gJCggXCIjXCIgKyB0YXhvbm9teU5hbWUgKyAnY2hlY2tsaXN0IGlucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkOmZpcnN0JyApO1xuXG5cdFx0c2V0UHJpbWFyeVRlcm0oIHRheG9ub215TmFtZSwgZmlyc3RUZXJtLnZhbCgpICk7XG5cdFx0dXBkYXRlUHJpbWFyeVRlcm1TZWxlY3RvcnMoIHRheG9ub215TmFtZSApO1xuXHR9XG5cblx0LyoqXG5cdCAqIElmIHdlIGNoZWNrIGEgdGVybSB3aGlsZSB0aGVyZSBpcyBubyBwcmltYXJ5IHRlcm0gd2UgbWFrZSB0aGF0IG9uZSB0aGUgcHJpbWFyeSB0ZXJtLlxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdGF4b25vbXlOYW1lXG5cdCAqXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxuXHQgKi9cblx0ZnVuY3Rpb24gZW5zdXJlUHJpbWFyeVRlcm0oIHRheG9ub215TmFtZSApIHtcblx0XHRpZiAoIFwiXCIgPT09IGdldFByaW1hcnlUZXJtKCB0YXhvbm9teU5hbWUgKSApIHtcblx0XHRcdG1ha2VGaXJzdFRlcm1QcmltYXJ5KCB0YXhvbm9teU5hbWUgKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyB0aGUgdGVybSBjaGVja2JveCBoYW5kbGVyIGZvciBhIGNlcnRhaW4gdGF4b25vbXkgbmFtZVxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdGF4b25vbXlOYW1lXG5cdCAqIEByZXR1cm5zIHtGdW5jdGlvbn1cblx0ICovXG5cdGZ1bmN0aW9uIHRlcm1DaGVja2JveEhhbmRsZXIoIHRheG9ub215TmFtZSApIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdFx0XHQvLyBJZiB0aGUgdXNlciB1bmNoZWNrcyB0aGUgcHJpbWFyeSBjYXRlZ29yeSB3ZSBoYXZlIHRvIHNlbGVjdCBhbnkgbmV3IHByaW1hcnkgdGVybVxuXHRcdFx0aWYgKCBmYWxzZSA9PT0gJCggdGhpcyApLnByb3AoIFwiY2hlY2tlZFwiICkgJiYgJCggdGhpcyApLnZhbCgpID09PSBnZXRQcmltYXJ5VGVybSggdGF4b25vbXlOYW1lICkgKSB7XG5cdFx0XHRcdG1ha2VGaXJzdFRlcm1QcmltYXJ5KCB0YXhvbm9teU5hbWUgKTtcblx0XHRcdH1cblxuXHRcdFx0ZW5zdXJlUHJpbWFyeVRlcm0oIHRheG9ub215TmFtZSApO1xuXG5cdFx0XHR1cGRhdGVQcmltYXJ5VGVybVNlbGVjdG9ycyggdGF4b25vbXlOYW1lICk7XG5cdFx0fTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRoZSB0ZXJtIGxpc3QgYWRkIGhhbmRsZXIgZm9yIGEgY2VydGFpbiB0YXhvbm9teSBuYW1lXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0YXhvbm9teU5hbWVcblx0ICogQHJldHVybnMge0Z1bmN0aW9ufVxuXHQgKi9cblx0ZnVuY3Rpb24gdGVybUxpc3RBZGRIYW5kbGVyKCB0YXhvbm9teU5hbWUgKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xuXHRcdFx0ZW5zdXJlUHJpbWFyeVRlcm0oIHRheG9ub215TmFtZSApO1xuXHRcdFx0dXBkYXRlUHJpbWFyeVRlcm1TZWxlY3RvcnMoIHRheG9ub215TmFtZSApO1xuXHRcdH07XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyB0aGUgbWFrZSBwcmltYXJ5IGV2ZW50IGhhbmRsZXIgZm9yIGEgY2VydGFpbiB0YXhvbm9teSBuYW1lXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0YXhvbm9teU5hbWVcblx0ICogQHJldHVybnMge0Z1bmN0aW9ufVxuXHQgKi9cblx0ZnVuY3Rpb24gbWFrZVByaW1hcnlIYW5kbGVyKCB0YXhvbm9teU5hbWUgKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0dmFyIHRlcm0sIGNoZWNrYm94O1xuXG5cdFx0XHR0ZXJtID0gJCggZS5jdXJyZW50VGFyZ2V0ICk7XG5cdFx0XHRjaGVja2JveCA9IHRlcm0uc2libGluZ3MoIFwibGFiZWxcIiApLmZpbmQoIFwiaW5wdXRcIiApO1xuXG5cdFx0XHRzZXRQcmltYXJ5VGVybSggdGF4b25vbXlOYW1lLCBjaGVja2JveC52YWwoKSApO1xuXG5cdFx0XHR1cGRhdGVQcmltYXJ5VGVybVNlbGVjdG9ycyggdGF4b25vbXlOYW1lICk7XG5cblx0XHRcdC8vIFRoZSBjbGlja2VkIGxpbmsgd2lsbCBiZSBoaWRkZW4gc28gd2UgbmVlZCB0byBmb2N1cyBzb21ldGhpbmcgZGlmZmVyZW50LlxuXHRcdFx0Y2hlY2tib3guZm9jdXMoKTtcblx0XHR9O1xuXHR9XG5cblx0JC5mbi5pbml0WXN0U0VPUHJpbWFyeUNhdGVnb3J5ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oIGksIHRheG9ub215ICkge1xuXHRcdFx0dmFyIG1ldGFib3hUYXhvbm9teSwgaHRtbDtcblxuXHRcdFx0bWV0YWJveFRheG9ub215ID0gJCggXCIjXCIgKyB0YXhvbm9teS5uYW1lICsgXCJkaXZcIiApO1xuXG5cdFx0XHRodG1sID0gcHJpbWFyeVRlcm1JbnB1dFRlbXBsYXRlKCB7XG5cdFx0XHRcdHRheG9ub215OiB0YXhvbm9teSxcblx0XHRcdH0gKTtcblxuXHRcdFx0bWV0YWJveFRheG9ub215LmFwcGVuZCggaHRtbCApO1xuXG5cdFx0XHR1cGRhdGVQcmltYXJ5VGVybVNlbGVjdG9ycyggdGF4b25vbXkubmFtZSApO1xuXG5cdFx0XHRtZXRhYm94VGF4b25vbXkub24oIFwiY2xpY2tcIiwgJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScsIHRlcm1DaGVja2JveEhhbmRsZXIoIHRheG9ub215Lm5hbWUgKSApO1xuXG5cdFx0XHQvLyBXaGVuIHRoZSBBSkFYIFJlcXVlc3QgaXMgZG9uZSwgdGhpcyBldmVudCB3aWxsIGJlIGZpcmVkLlxuXHRcdFx0bWV0YWJveFRheG9ub215Lm9uKCBcIndwTGlzdEFkZEVuZFwiLCBcIiNcIiArIHRheG9ub215Lm5hbWUgKyBcImNoZWNrbGlzdFwiLCB0ZXJtTGlzdEFkZEhhbmRsZXIoIHRheG9ub215Lm5hbWUgKSApO1xuXG5cdFx0XHRtZXRhYm94VGF4b25vbXkub24oIFwiY2xpY2tcIiwgXCIud3BzZW8tbWFrZS1wcmltYXJ5LXRlcm1cIiwgbWFrZVByaW1hcnlIYW5kbGVyKCB0YXhvbm9teS5uYW1lICkgKTtcblx0XHR9ICk7XG5cdH07XG5cblx0JCggZnVuY3Rpb24oKSB7XG5cdFx0Ly8gSW5pdGlhbGl6ZSBvdXIgdGVtcGxhdGVzXG5cdFx0cHJpbWFyeVRlcm1JbnB1dFRlbXBsYXRlID0gd3AudGVtcGxhdGUoIFwicHJpbWFyeS10ZXJtLWlucHV0XCIgKTtcblx0XHRwcmltYXJ5VGVybVVJVGVtcGxhdGUgPSB3cC50ZW1wbGF0ZSggXCJwcmltYXJ5LXRlcm0tdWlcIiApO1xuXHRcdHByaW1hcnlUZXJtU2NyZWVuUmVhZGVyVGVtcGxhdGUgPSB3cC50ZW1wbGF0ZSggXCJwcmltYXJ5LXRlcm0tc2NyZWVuLXJlYWRlclwiICk7XG5cblx0XHQkKCBfLnZhbHVlcyggdGF4b25vbWllcyApICkuaW5pdFlzdFNFT1ByaW1hcnlDYXRlZ29yeSgpO1xuXHR9ICk7XG59KCBqUXVlcnkgKSApO1xuIl19
