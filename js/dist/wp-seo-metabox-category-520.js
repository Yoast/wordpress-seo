(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

/* global wp, _, wpseoPrimaryCategoryL10n */
(function ($) {
	"use strict";

	var primaryTermInputTemplate, primaryTermUITemplate, primaryTermScreenReaderTemplate;
	var taxonomies = wpseoPrimaryCategoryL10n.taxonomies;

	/**
  * Checks if the elements to make a term the primary term and the display for a primary term exist.
  *
  * @param {Object} checkbox The checkbox to get the closest required fields for.
  *
  * @returns {boolean} True when there are primary elements.
  */
	function hasPrimaryTermElements(checkbox) {
		return 1 === $(checkbox).closest("li").children(".wpseo-make-primary-term").length;
	}

	/**
  * Retrieves the primary term for a taxonomy.
  *
  * @param {string} taxonomyName The taxonomy name.
  *
  * @returns {string} The value of the primary term.
  */
	function getPrimaryTerm(taxonomyName) {
		var primaryTermInput;

		primaryTermInput = $("#yoast-wpseo-primary-" + taxonomyName);
		return primaryTermInput.val();
	}

	/**
  * Sets the primary term for a taxonomy.
  *
  * @param {string} taxonomyName The taxonomy name.
  * @param {string} termId       The term id.
  *
  * @returns {void}
  */
	function setPrimaryTerm(taxonomyName, termId) {
		var primaryTermInput;

		primaryTermInput = $("#yoast-wpseo-primary-" + taxonomyName);
		primaryTermInput.val(termId).trigger("change");
	}

	/**
  * Creates the elements necessary to show something is a primary term or to make it the primary term.
  *
  * @param {string} taxonomyName The taxonomy name.
  * @param {Object} checkbox     The checkbox to get label for.
  *
  * @returns {void}
  */
	function createPrimaryTermElements(taxonomyName, checkbox) {
		var label, html;

		label = $(checkbox).closest("label");

		html = primaryTermUITemplate({
			taxonomy: taxonomies[taxonomyName],
			term: label.text()
		});

		label.after(html);
	}

	/**
  * Updates the primary term selectors/indicators for a certain taxonomy.
  *
  * @param {string} taxonomyName The taxonomy name.
  *
  * @returns {void}
  */
	function updatePrimaryTermSelectors(taxonomyName) {
		var checkedTerms;
		var listItem, label;

		checkedTerms = $("#" + taxonomyName + 'checklist input[type="checkbox"]:checked');

		var taxonomyListItem = $("#" + taxonomyName + "checklist li");
		taxonomyListItem.removeClass("wpseo-term-unchecked wpseo-primary-term wpseo-non-primary-term");

		$(".wpseo-primary-category-label").remove();
		taxonomyListItem.addClass("wpseo-term-unchecked");

		// If there is only one term selected we don't want to show our interface.
		if (checkedTerms.length <= 1) {
			return;
		}

		checkedTerms.each(function (i, term) {
			term = $(term);
			listItem = term.closest("li");
			listItem.removeClass("wpseo-term-unchecked");

			// Create our interface elements if they don't exist.
			if (!hasPrimaryTermElements(term)) {
				createPrimaryTermElements(taxonomyName, term);
			}

			if (term.val() === getPrimaryTerm(taxonomyName)) {
				listItem.addClass("wpseo-primary-term");

				label = term.closest("label");
				label.find(".wpseo-primary-category-label").remove();
				label.append(primaryTermScreenReaderTemplate({
					taxonomy: taxonomies[taxonomyName]
				}));
			} else {
				listItem.addClass("wpseo-non-primary-term");
			}
		});
	}

	/**
  * Makes the first term primary for a certain taxonomy.
  *
  * @param {string} taxonomyName The taxonomy name.
  *
  * @returns {void}
  */
	function makeFirstTermPrimary(taxonomyName) {
		var firstTerm = $("#" + taxonomyName + 'checklist input[type="checkbox"]:checked:first');

		setPrimaryTerm(taxonomyName, firstTerm.val());
		updatePrimaryTermSelectors(taxonomyName);
	}

	/**
  * If we check a term while there is no primary term we make that one the primary term.
  *
  * @param {string} taxonomyName The taxonomy name.
  *
  * @returns {void}
  */
	function ensurePrimaryTerm(taxonomyName) {
		if ("" === getPrimaryTerm(taxonomyName)) {
			makeFirstTermPrimary(taxonomyName);
		}
	}

	/**
  * Returns the term checkbox handler for a certain taxonomy name.
  *
  * @param {string} taxonomyName The taxonomy name.
  *
  * @returns {Function} Event handler for the checkbox.
  */
	function termCheckboxHandler(taxonomyName) {
		return function () {
			// If the user unchecks the primary category we have to select any new primary term
			if (false === $(this).prop("checked") && $(this).val() === getPrimaryTerm(taxonomyName)) {
				makeFirstTermPrimary(taxonomyName);
			}

			ensurePrimaryTerm(taxonomyName);

			updatePrimaryTermSelectors(taxonomyName);
		};
	}

	/**
  * Returns the term list add handler for a certain taxonomy name.
  *
  * @param {string} taxonomyName The taxonomy name.
  *
  * @returns {Function} The term list add handler.
  */
	function termListAddHandler(taxonomyName) {
		return function () {
			ensurePrimaryTerm(taxonomyName);
			updatePrimaryTermSelectors(taxonomyName);
		};
	}

	/**
  * Returns the make primary event handler for a certain taxonomy name.
  *
  * @param {string} taxonomyName The taxonomy name.
  *
  * @returns {Function} The event handler.
  */
	function makePrimaryHandler(taxonomyName) {
		return function (e) {
			var term, checkbox;

			term = $(e.currentTarget);
			checkbox = term.siblings("label").find("input");

			setPrimaryTerm(taxonomyName, checkbox.val());

			updatePrimaryTermSelectors(taxonomyName);

			// The clicked link will be hidden so we need to focus something different.
			checkbox.focus();
		};
	}

	$.fn.initYstSEOPrimaryCategory = function () {
		return this.each(function (i, taxonomy) {
			var metaboxTaxonomy, html;

			metaboxTaxonomy = $("#" + taxonomy.name + "div");

			html = primaryTermInputTemplate({
				taxonomy: taxonomy
			});

			metaboxTaxonomy.append(html);

			updatePrimaryTermSelectors(taxonomy.name);

			metaboxTaxonomy.on("click", 'input[type="checkbox"]', termCheckboxHandler(taxonomy.name));

			// When the AJAX Request is done, this event will be fired.
			metaboxTaxonomy.on("wpListAddEnd", "#" + taxonomy.name + "checklist", termListAddHandler(taxonomy.name));

			metaboxTaxonomy.on("click", ".wpseo-make-primary-term", makePrimaryHandler(taxonomy.name));
		});
	};

	$(function () {
		// Initialize our templates
		primaryTermInputTemplate = wp.template("primary-term-input");
		primaryTermUITemplate = wp.template("primary-term-ui");
		primaryTermScreenReaderTemplate = wp.template("primary-term-screen-reader");

		$(_.values(taxonomies)).initYstSEOPrimaryCategory();
	});
})(jQuery);

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9zcmMvd3Atc2VvLW1ldGFib3gtY2F0ZWdvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBO0FBQ0UsV0FBVSxDQUFWLEVBQWM7QUFDZjs7QUFFQSxLQUFJLHdCQUFKLEVBQThCLHFCQUE5QixFQUFxRCwrQkFBckQ7QUFDQSxLQUFJLGFBQWEseUJBQXlCLFVBQTFDOztBQUVBOzs7Ozs7O0FBT0EsVUFBUyxzQkFBVCxDQUFpQyxRQUFqQyxFQUE0QztBQUMzQyxTQUFPLE1BQU0sRUFBRyxRQUFILEVBQWMsT0FBZCxDQUF1QixJQUF2QixFQUE4QixRQUE5QixDQUF3QywwQkFBeEMsRUFBcUUsTUFBbEY7QUFDQTs7QUFFRDs7Ozs7OztBQU9BLFVBQVMsY0FBVCxDQUF5QixZQUF6QixFQUF3QztBQUN2QyxNQUFJLGdCQUFKOztBQUVBLHFCQUFtQixFQUFHLDBCQUEwQixZQUE3QixDQUFuQjtBQUNBLFNBQU8saUJBQWlCLEdBQWpCLEVBQVA7QUFDQTs7QUFFRDs7Ozs7Ozs7QUFRQSxVQUFTLGNBQVQsQ0FBeUIsWUFBekIsRUFBdUMsTUFBdkMsRUFBZ0Q7QUFDL0MsTUFBSSxnQkFBSjs7QUFFQSxxQkFBbUIsRUFBRywwQkFBMEIsWUFBN0IsQ0FBbkI7QUFDQSxtQkFBaUIsR0FBakIsQ0FBc0IsTUFBdEIsRUFBK0IsT0FBL0IsQ0FBd0MsUUFBeEM7QUFDQTs7QUFFRDs7Ozs7Ozs7QUFRQSxVQUFTLHlCQUFULENBQW9DLFlBQXBDLEVBQWtELFFBQWxELEVBQTZEO0FBQzVELE1BQUksS0FBSixFQUFXLElBQVg7O0FBRUEsVUFBUSxFQUFHLFFBQUgsRUFBYyxPQUFkLENBQXVCLE9BQXZCLENBQVI7O0FBRUEsU0FBTyxzQkFBdUI7QUFDN0IsYUFBVSxXQUFZLFlBQVosQ0FEbUI7QUFFN0IsU0FBTSxNQUFNLElBQU47QUFGdUIsR0FBdkIsQ0FBUDs7QUFLQSxRQUFNLEtB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R0FBaUMsWUFBVztBQUMzQyxTQUFPLEtBQUssSUFBTCxDQUFXLFVBQVUsQ0FBVixFQUFhLFFBQWIsRUFBd0I7QUFDekMsT0FBSSxlQUFKLEVBQXFCLElBQXJCOztBQUVBLHFCQUFrQixFQUFHLE1BQU0sU0FBUyxJQUFmLEdBQXNCLEtBQXpCLENBQWxCOztBQUVBLFVBQU8seUJBQTBCO0FBQ2hDLGNBQVU7QUFEc0IsSUFBMUIsQ0FBUDs7QUFJQSxtQkFBZ0IsTUFBaEIsQ0FBd0IsSUFBeEI7O0FBRUEsOEJBQTRCLFNBQVMsSUFBckM7O0FBRUEsbUJBQWdCLEVBQWhCLENBQW9CLE9BQXBCLEVBQTZCLHdCQUE3QixFQUF1RCxvQkFBcUIsU0FBUyxJQUE5QixDQUF2RDs7QUFFQTtBQUNBLG1CQUFnQixFQUFoQixDQUFvQixjQUFwQixFQUFvQyxNQUFNLFNBQVMsSUFBZixHQUFzQixXQUExRCxFQUF1RSxtQkFBb0IsU0FBUyxJQUE3QixDQUF2RTs7QUFFQSxtQkFBZ0IsRUFBaEIsQ0FBb0IsT0FBcEIsRUFBNkIsMEJBQTdCLEVBQXlELG1CQUFvQixTQUFTLElBQTdCLENBQXpEO0FBQ0EsR0FuQk0sQ0FBUDtBQW9CQSxFQXJCRDs7QUF1QkEsR0FBRyxZQUFXO0FBQ2I7QUFDQSw2QkFBMkIsR0FBRyxRQUFILENBQWEsb0JBQWIsQ0FBM0I7QUFDQSwwQkFBd0IsR0FBRyxRQUFILENBQWEsaUJBQWIsQ0FBeEI7QUFDQSxvQ0FBa0MsR0FBRyxRQUFILENBQWEsNEJBQWIsQ0FBbEM7O0FBRUEsSUFBRyxFQUFFLE1BQUYsQ0FBVSxVQUFWLENBQUgsRUFBNEIseUJBQTVCO0FBQ0EsRUFQRDtBQVFBLENBdk9DLEVBdU9DLE1Bdk9ELENBQUYiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyogZ2xvYmFsIHdwLCBfLCB3cHNlb1ByaW1hcnlDYXRlZ29yeUwxMG4gKi9cbiggZnVuY3Rpb24oICQgKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHZhciBwcmltYXJ5VGVybUlucHV0VGVtcGxhdGUsIHByaW1hcnlUZXJtVUlUZW1wbGF0ZSwgcHJpbWFyeVRlcm1TY3JlZW5SZWFkZXJUZW1wbGF0ZTtcblx0dmFyIHRheG9ub21pZXMgPSB3cHNlb1ByaW1hcnlDYXRlZ29yeUwxMG4udGF4b25vbWllcztcblxuXHQvKipcblx0ICogQ2hlY2tzIGlmIHRoZSBlbGVtZW50cyB0byBtYWtlIGEgdGVybSB0aGUgcHJpbWFyeSB0ZXJtIGFuZCB0aGUgZGlzcGxheSBmb3IgYSBwcmltYXJ5IHRlcm0gZXhpc3QuXG5cdCAqXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBjaGVja2JveCBUaGUgY2hlY2tib3ggdG8gZ2V0IHRoZSBjbG9zZXN0IHJlcXVpcmVkIGZpZWxkcyBmb3IuXG5cdCAqXG5cdCAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIHdoZW4gdGhlcmUgYXJlIHByaW1hcnkgZWxlbWVudHMuXG5cdCAqL1xuXHRmdW5jdGlvbiBoYXNQcmltYXJ5VGVybUVsZW1lbnRzKCBjaGVja2JveCApIHtcblx0XHRyZXR1cm4gMSA9PT0gJCggY2hlY2tib3ggKS5jbG9zZXN0KCBcImxpXCIgKS5jaGlsZHJlbiggXCIud3BzZW8tbWFrZS1wcmltYXJ5LXRlcm1cIiApLmxlbmd0aDtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXRyaWV2ZXMgdGhlIHByaW1hcnkgdGVybSBmb3IgYSB0YXhvbm9teS5cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IHRheG9ub215TmFtZSBUaGUgdGF4b25vbXkgbmFtZS5cblx0ICpcblx0ICogQHJldHVybnMge3N0cmluZ30gVGhlIHZhbHVlIG9mIHRoZSBwcmltYXJ5IHRlcm0uXG5cdCAqL1xuXHRmdW5jdGlvbiBnZXRQcmltYXJ5VGVybSggdGF4b25vbXlOYW1lICkge1xuXHRcdHZhciBwcmltYXJ5VGVybUlucHV0O1xuXG5cdFx0cHJpbWFyeVRlcm1JbnB1dCA9ICQoIFwiI3lvYXN0LXdwc2VvLXByaW1hcnktXCIgKyB0YXhvbm9teU5hbWUgKTtcblx0XHRyZXR1cm4gcHJpbWFyeVRlcm1JbnB1dC52YWwoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTZXRzIHRoZSBwcmltYXJ5IHRlcm0gZm9yIGEgdGF4b25vbXkuXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0YXhvbm9teU5hbWUgVGhlIHRheG9ub215IG5hbWUuXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0ZXJtSWQgICAgICAgVGhlIHRlcm0gaWQuXG5cdCAqXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxuXHQgKi9cblx0ZnVuY3Rpb24gc2V0UHJpbWFyeVRlcm0oIHRheG9ub215TmFtZSwgdGVybUlkICkge1xuXHRcdHZhciBwcmltYXJ5VGVybUlucHV0O1xuXG5cdFx0cHJpbWFyeVRlcm1JbnB1dCA9ICQoIFwiI3lvYXN0LXdwc2VvLXByaW1hcnktXCIgKyB0YXhvbm9teU5hbWUgKTtcblx0XHRwcmltYXJ5VGVybUlucHV0LnZhbCggdGVybUlkICkudHJpZ2dlciggXCJjaGFuZ2VcIiApO1xuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgdGhlIGVsZW1lbnRzIG5lY2Vzc2FyeSB0byBzaG93IHNvbWV0aGluZyBpcyBhIHByaW1hcnkgdGVybSBvciB0byBtYWtlIGl0IHRoZSBwcmltYXJ5IHRlcm0uXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0YXhvbm9teU5hbWUgVGhlIHRheG9ub215IG5hbWUuXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBjaGVja2JveCAgICAgVGhlIGNoZWNrYm94IHRvIGdldCBsYWJlbCBmb3IuXG5cdCAqXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxuXHQgKi9cblx0ZnVuY3Rpb24gY3JlYXRlUHJpbWFyeVRlcm1FbGVtZW50cyggdGF4b25vbXlOYW1lLCBjaGVja2JveCApIHtcblx0XHR2YXIgbGFiZWwsIGh0bWw7XG5cblx0XHRsYWJlbCA9ICQoIGNoZWNrYm94ICkuY2xvc2VzdCggXCJsYWJlbFwiICk7XG5cblx0XHRodG1sID0gcHJpbWFyeVRlcm1VSVRlbXBsYXRlKCB7XG5cdFx0XHR0YXhvbm9teTogdGF4b25vbWllc1sgdGF4b25vbXlOYW1lIF0sXG5cdFx0XHR0ZXJtOiBsYWJlbC50ZXh0KCksXG5cdFx0fSApO1xuXG5cdFx0bGFiZWwuYWZ0ZXIoIGh0bWwgKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBVcGRhdGVzIHRoZSBwcmltYXJ5IHRlcm0gc2VsZWN0b3JzL2luZGljYXRvcnMgZm9yIGEgY2VydGFpbiB0YXhvbm9teS5cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IHRheG9ub215TmFtZSBUaGUgdGF4b25vbXkgbmFtZS5cblx0ICpcblx0ICogQHJldHVybnMge3ZvaWR9XG5cdCAqL1xuXHRmdW5jdGlvbiB1cGRhdGVQcmltYXJ5VGVybVNlbGVjdG9ycyggdGF4b25vbXlOYW1lICkge1xuXHRcdHZhciBjaGVja2VkVGVybXM7XG5cdFx0dmFyIGxpc3RJdGVtLCBsYWJlbDtcblxuXHRcdGNoZWNrZWRUZXJtcyA9ICQoIFwiI1wiICsgdGF4b25vbXlOYW1lICsgJ2NoZWNrbGlzdCBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcgKTtcblxuXHRcdHZhciB0YXhvbm9teUxpc3RJdGVtID0gJCggXCIjXCIgKyB0YXhvbm9teU5hbWUgKyBcImNoZWNrbGlzdCBsaVwiICk7XG5cdFx0dGF4b25vbXlMaXN0SXRlbS5yZW1vdmVDbGFzcyggXCJ3cHNlby10ZXJtLXVuY2hlY2tlZCB3cHNlby1wcmltYXJ5LXRlcm0gd3BzZW8tbm9uLXByaW1hcnktdGVybVwiICk7XG5cblx0XHQkKCBcIi53cHNlby1wcmltYXJ5LWNhdGVnb3J5LWxhYmVsXCIgKS5yZW1vdmUoKTtcblx0XHR0YXhvbm9teUxpc3RJdGVtLmFkZENsYXNzKCBcIndwc2VvLXRlcm0tdW5jaGVja2VkXCIgKTtcblxuXHRcdC8vIElmIHRoZXJlIGlzIG9ubHkgb25lIHRlcm0gc2VsZWN0ZWQgd2UgZG9uJ3Qgd2FudCB0byBzaG93IG91ciBpbnRlcmZhY2UuXG5cdFx0aWYgKCBjaGVja2VkVGVybXMubGVuZ3RoIDw9IDEgKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y2hlY2tlZFRlcm1zLmVhY2goIGZ1bmN0aW9uKCBpLCB0ZXJtICkge1xuXHRcdFx0dGVybSA9ICQoIHRlcm0gKTtcblx0XHRcdGxpc3RJdGVtID0gdGVybS5jbG9zZXN0KCBcImxpXCIgKTtcblx0XHRcdGxpc3RJdGVtLnJlbW92ZUNsYXNzKCBcIndwc2VvLXRlcm0tdW5jaGVja2VkXCIgKTtcblxuXHRcdFx0Ly8gQ3JlYXRlIG91ciBpbnRlcmZhY2UgZWxlbWVudHMgaWYgdGhleSBkb24ndCBleGlzdC5cblx0XHRcdGlmICggISBoYXNQcmltYXJ5VGVybUVsZW1lbnRzKCB0ZXJtICkgKSB7XG5cdFx0XHRcdGNyZWF0ZVByaW1hcnlUZXJtRWxlbWVudHMoIHRheG9ub215TmFtZSwgdGVybSApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIHRlcm0udmFsKCkgPT09IGdldFByaW1hcnlUZXJtKCB0YXhvbm9teU5hbWUgKSApIHtcblx0XHRcdFx0bGlzdEl0ZW0uYWRkQ2xhc3MoIFwid3BzZW8tcHJpbWFyeS10ZXJtXCIgKTtcblxuXHRcdFx0XHRsYWJlbCA9IHRlcm0uY2xvc2VzdCggXCJsYWJlbFwiICk7XG5cdFx0XHRcdGxhYmVsLmZpbmQoIFwiLndwc2VvLXByaW1hcnktY2F0ZWdvcnktbGFiZWxcIiApLnJlbW92ZSgpO1xuXHRcdFx0XHRsYWJlbC5hcHBlbmQoIHByaW1hcnlUZXJtU2NyZWVuUmVhZGVyVGVtcGxhdGUoIHtcblx0XHRcdFx0XHR0YXhvbm9teTogdGF4b25vbWllc1sgdGF4b25vbXlOYW1lIF0sXG5cdFx0XHRcdH0gKSApO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGxpc3RJdGVtLmFkZENsYXNzKCBcIndwc2VvLW5vbi1wcmltYXJ5LXRlcm1cIiApO1xuXHRcdFx0fVxuXHRcdH0gKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBNYWtlcyB0aGUgZmlyc3QgdGVybSBwcmltYXJ5IGZvciBhIGNlcnRhaW4gdGF4b25vbXkuXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0YXhvbm9teU5hbWUgVGhlIHRheG9ub215IG5hbWUuXG5cdCAqXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxuXHQgKi9cblx0ZnVuY3Rpb24gbWFrZUZpcnN0VGVybVByaW1hcnkoIHRheG9ub215TmFtZSApIHtcblx0XHR2YXIgZmlyc3RUZXJtID0gJCggXCIjXCIgKyB0YXhvbm9teU5hbWUgKyAnY2hlY2tsaXN0IGlucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkOmZpcnN0JyApO1xuXG5cdFx0c2V0UHJpbWFyeVRlcm0oIHRheG9ub215TmFtZSwgZmlyc3RUZXJtLnZhbCgpICk7XG5cdFx0dXBkYXRlUHJpbWFyeVRlcm1TZWxlY3RvcnMoIHRheG9ub215TmFtZSApO1xuXHR9XG5cblx0LyoqXG5cdCAqIElmIHdlIGNoZWNrIGEgdGVybSB3aGlsZSB0aGVyZSBpcyBubyBwcmltYXJ5IHRlcm0gd2UgbWFrZSB0aGF0IG9uZSB0aGUgcHJpbWFyeSB0ZXJtLlxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdGF4b25vbXlOYW1lIFRoZSB0YXhvbm9teSBuYW1lLlxuXHQgKlxuXHQgKiBAcmV0dXJucyB7dm9pZH1cblx0ICovXG5cdGZ1bmN0aW9uIGVuc3VyZVByaW1hcnlUZXJtKCB0YXhvbm9teU5hbWUgKSB7XG5cdFx0aWYgKCBcIlwiID09PSBnZXRQcmltYXJ5VGVybSggdGF4b25vbXlOYW1lICkgKSB7XG5cdFx0XHRtYWtlRmlyc3RUZXJtUHJpbWFyeSggdGF4b25vbXlOYW1lICk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIHRlcm0gY2hlY2tib3ggaGFuZGxlciBmb3IgYSBjZXJ0YWluIHRheG9ub215IG5hbWUuXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0YXhvbm9teU5hbWUgVGhlIHRheG9ub215IG5hbWUuXG5cdCAqXG5cdCAqIEByZXR1cm5zIHtGdW5jdGlvbn0gRXZlbnQgaGFuZGxlciBmb3IgdGhlIGNoZWNrYm94LlxuXHQgKi9cblx0ZnVuY3Rpb24gdGVybUNoZWNrYm94SGFuZGxlciggdGF4b25vbXlOYW1lICkge1xuXHRcdHJldHVybiBmdW5jdGlvbigpIHtcblx0XHRcdC8vIElmIHRoZSB1c2VyIHVuY2hlY2tzIHRoZSBwcmltYXJ5IGNhdGVnb3J5IHdlIGhhdmUgdG8gc2VsZWN0IGFueSBuZXcgcHJpbWFyeSB0ZXJtXG5cdFx0XHRpZiAoIGZhbHNlID09PSAkKCB0aGlzICkucHJvcCggXCJjaGVja2VkXCIgKSAmJiAkKCB0aGlzICkudmFsKCkgPT09IGdldFByaW1hcnlUZXJtKCB0YXhvbm9teU5hbWUgKSApIHtcblx0XHRcdFx0bWFrZUZpcnN0VGVybVByaW1hcnkoIHRheG9ub215TmFtZSApO1xuXHRcdFx0fVxuXG5cdFx0XHRlbnN1cmVQcmltYXJ5VGVybSggdGF4b25vbXlOYW1lICk7XG5cblx0XHRcdHVwZGF0ZVByaW1hcnlUZXJtU2VsZWN0b3JzKCB0YXhvbm9teU5hbWUgKTtcblx0XHR9O1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIHRlcm0gbGlzdCBhZGQgaGFuZGxlciBmb3IgYSBjZXJ0YWluIHRheG9ub215IG5hbWUuXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0YXhvbm9teU5hbWUgVGhlIHRheG9ub215IG5hbWUuXG5cdCAqXG5cdCAqIEByZXR1cm5zIHtGdW5jdGlvbn0gVGhlIHRlcm0gbGlzdCBhZGQgaGFuZGxlci5cblx0ICovXG5cdGZ1bmN0aW9uIHRlcm1MaXN0QWRkSGFuZGxlciggdGF4b25vbXlOYW1lICkge1xuXHRcdHJldHVybiBmdW5jdGlvbigpIHtcblx0XHRcdGVuc3VyZVByaW1hcnlUZXJtKCB0YXhvbm9teU5hbWUgKTtcblx0XHRcdHVwZGF0ZVByaW1hcnlUZXJtU2VsZWN0b3JzKCB0YXhvbm9teU5hbWUgKTtcblx0XHR9O1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIG1ha2UgcHJpbWFyeSBldmVudCBoYW5kbGVyIGZvciBhIGNlcnRhaW4gdGF4b25vbXkgbmFtZS5cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IHRheG9ub215TmFtZSBUaGUgdGF4b25vbXkgbmFtZS5cblx0ICpcblx0ICogQHJldHVybnMge0Z1bmN0aW9ufSBUaGUgZXZlbnQgaGFuZGxlci5cblx0ICovXG5cdGZ1bmN0aW9uIG1ha2VQcmltYXJ5SGFuZGxlciggdGF4b25vbXlOYW1lICkge1xuXHRcdHJldHVybiBmdW5jdGlvbiggZSApIHtcblx0XHRcdHZhciB0ZXJtLCBjaGVja2JveDtcblxuXHRcdFx0dGVybSA9ICQoIGUuY3VycmVudFRhcmdldCApO1xuXHRcdFx0Y2hlY2tib3ggPSB0ZXJtLnNpYmxpbmdzKCBcImxhYmVsXCIgKS5maW5kKCBcImlucHV0XCIgKTtcblxuXHRcdFx0c2V0UHJpbWFyeVRlcm0oIHRheG9ub215TmFtZSwgY2hlY2tib3gudmFsKCkgKTtcblxuXHRcdFx0dXBkYXRlUHJpbWFyeVRlcm1TZWxlY3RvcnMoIHRheG9ub215TmFtZSApO1xuXG5cdFx0XHQvLyBUaGUgY2xpY2tlZCBsaW5rIHdpbGwgYmUgaGlkZGVuIHNvIHdlIG5lZWQgdG8gZm9jdXMgc29tZXRoaW5nIGRpZmZlcmVudC5cblx0XHRcdGNoZWNrYm94LmZvY3VzKCk7XG5cdFx0fTtcblx0fVxuXG5cdCQuZm4uaW5pdFlzdFNFT1ByaW1hcnlDYXRlZ29yeSA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCBpLCB0YXhvbm9teSApIHtcblx0XHRcdHZhciBtZXRhYm94VGF4b25vbXksIGh0bWw7XG5cblx0XHRcdG1ldGFib3hUYXhvbm9teSA9ICQoIFwiI1wiICsgdGF4b25vbXkubmFtZSArIFwiZGl2XCIgKTtcblxuXHRcdFx0aHRtbCA9IHByaW1hcnlUZXJtSW5wdXRUZW1wbGF0ZSgge1xuXHRcdFx0XHR0YXhvbm9teTogdGF4b25vbXksXG5cdFx0XHR9ICk7XG5cblx0XHRcdG1ldGFib3hUYXhvbm9teS5hcHBlbmQoIGh0bWwgKTtcblxuXHRcdFx0dXBkYXRlUHJpbWFyeVRlcm1TZWxlY3RvcnMoIHRheG9ub215Lm5hbWUgKTtcblxuXHRcdFx0bWV0YWJveFRheG9ub215Lm9uKCBcImNsaWNrXCIsICdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nLCB0ZXJtQ2hlY2tib3hIYW5kbGVyKCB0YXhvbm9teS5uYW1lICkgKTtcblxuXHRcdFx0Ly8gV2hlbiB0aGUgQUpBWCBSZXF1ZXN0IGlzIGRvbmUsIHRoaXMgZXZlbnQgd2lsbCBiZSBmaXJlZC5cblx0XHRcdG1ldGFib3hUYXhvbm9teS5vbiggXCJ3cExpc3RBZGRFbmRcIiwgXCIjXCIgKyB0YXhvbm9teS5uYW1lICsgXCJjaGVja2xpc3RcIiwgdGVybUxpc3RBZGRIYW5kbGVyKCB0YXhvbm9teS5uYW1lICkgKTtcblxuXHRcdFx0bWV0YWJveFRheG9ub215Lm9uKCBcImNsaWNrXCIsIFwiLndwc2VvLW1ha2UtcHJpbWFyeS10ZXJtXCIsIG1ha2VQcmltYXJ5SGFuZGxlciggdGF4b25vbXkubmFtZSApICk7XG5cdFx0fSApO1xuXHR9O1xuXG5cdCQoIGZ1bmN0aW9uKCkge1xuXHRcdC8vIEluaXRpYWxpemUgb3VyIHRlbXBsYXRlc1xuXHRcdHByaW1hcnlUZXJtSW5wdXRUZW1wbGF0ZSA9IHdwLnRlbXBsYXRlKCBcInByaW1hcnktdGVybS1pbnB1dFwiICk7XG5cdFx0cHJpbWFyeVRlcm1VSVRlbXBsYXRlID0gd3AudGVtcGxhdGUoIFwicHJpbWFyeS10ZXJtLXVpXCIgKTtcblx0XHRwcmltYXJ5VGVybVNjcmVlblJlYWRlclRlbXBsYXRlID0gd3AudGVtcGxhdGUoIFwicHJpbWFyeS10ZXJtLXNjcmVlbi1yZWFkZXJcIiApO1xuXG5cdFx0JCggXy52YWx1ZXMoIHRheG9ub21pZXMgKSApLmluaXRZc3RTRU9QcmltYXJ5Q2F0ZWdvcnkoKTtcblx0fSApO1xufSggalF1ZXJ5ICkgKTtcbiJdfQ==
