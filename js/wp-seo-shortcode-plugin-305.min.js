!function(){"use strict";var a=function(){YoastSEO.app.registerPlugin("YoastShortcodePlugin",{status:"loading"}),this.bindElementEvents();var a="("+wpseoShortcodePluginL10n.wpseo_shortcode_tags.join("|")+")";this.keywordRegex=new RegExp(a,"g"),this.closingTagRegex=new RegExp("\\[\\/"+a+"\\]","g"),this.nonCaptureRegex=new RegExp("\\["+a+"[^\\]]*?\\]","g"),this.parsedShortcodes=[],this.loadShortcodes(this.declareReady.bind(this))};a.prototype.declareReady=function(){YoastSEO.app.pluginReady("YoastShortcodePlugin"),this.registerModifications()},a.prototype.declareReloaded=function(){YoastSEO.app.pluginReloaded("YoastShortcodePlugin")},a.prototype.registerModifications=function(){YoastSEO.app.registerModification("content",this.replaceShortcodes.bind(this),"YoastShortcodePlugin")},a.prototype.replaceShortcodes=function(a){var b=this.parsedShortcodes;if("string"==typeof a&&b.length>0)for(var c in b)a=a.replace(b[c].shortcode,b[c].output);return a},a.prototype.loadShortcodes=function(a){var b=this.getUnparsedShortcodes(this.getShortcodes(this.getContentTinyMCE()));b.length>0?this.parseShortcodes(b,a):a()},a.prototype.bindElementEvents=function(){var a=document.getElementById("content")||!1,b=this;a&&(a.addEventListener("keydown",this.loadShortcodes.bind(this,this.declareReloaded.bind(this))),a.addEventListener("change",this.loadShortcodes.bind(this,this.declareReloaded.bind(this)))),"undefined"!=typeof tinyMCE&&"function"==typeof tinyMCE.on&&tinyMCE.on("addEditor",function(a){a.editor.on("change",function(){b.loadShortcodes.bind(b,b.declareReloaded.bind(b))()}),a.editor.on("keydown",function(){b.loadShortcodes.bind(b,b.declareReloaded.bind(b))()})})},a.prototype.getContentTinyMCE=function(){var a=document.getElementById("content")&&document.getElementById("content").value||"";return"undefined"!=typeof tinyMCE&&"undefined"!=typeof tinyMCE.editors&&0!==tinyMCE.editors.length&&(a=tinyMCE.get("content")&&tinyMCE.get("content").getContent()||""),a},a.prototype.getUnparsedShortcodes=function(a){if("object"!=typeof a)return console.error("Failed to get unparsed shortcodes. Expected parameter to be an array, instead received "+typeof a),!1;var b=[];for(var c in a){var d=a[c];-1===b.indexOf(d)&&this.isUnparsedShortcode(d)&&b.push(d)}return b},a.prototype.isUnparsedShortcode=function(a){var b=!1;for(var c in this.parsedShortcodes)this.parsedShortcodes[c].shortcode===a&&(b=!0);return b===!1},a.prototype.getShortcodes=function(a){if("string"!=typeof a)return console.error("Failed to get shortcodes. Expected parameter to be a string, instead received"+typeof a),!1;var b=this.matchCapturingShortcodes(a);for(var c in b)a=a.replace(b[c],"");var d=this.matchNonCapturingShortcodes(a);return b.concat(d)},a.prototype.matchCapturingShortcodes=function(a){var b=[],c=(a.match(this.closingTagRegex)||[]).join(" ").match(this.keywordRegex)||[];for(var d in c){var e=c[d],f="\\["+e+"[^\\]]*?\\].*?\\[\\/"+e+"\\]",g=a.match(new RegExp(f,"g"))||[];b=b.concat(g)}return b},a.prototype.matchNonCapturingShortcodes=function(a){return a.match(this.nonCaptureRegex)||[]},a.prototype.parseShortcodes=function(a,b){return"function"!=typeof b?(console.error("Failed to parse shortcodes. Expected parameter to be a function, instead received "+typeof b),!1):void("object"==typeof a&&a.length>0?jQuery.post(ajaxurl,{action:"wpseo_filter_shortcodes",_wpnonce:wpseoShortcodePluginL10n.wpseo_filter_shortcodes_nonce,data:a},function(a){this.saveParsedShortcodes(a,b)}.bind(this)):b())},a.prototype.saveParsedShortcodes=function(a,b){a=JSON.parse(a);for(var c in a)this.parsedShortcodes.push(a[c]);b()},window.YoastShortcodePlugin=a}();