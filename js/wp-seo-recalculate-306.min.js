!function(a){"use strict";function b(){var a=jQuery("#wpseo_recalculate_link");void 0!==a&&(a.click(function(){jQuery("#wpseo_count").text(0),g.start(d,"post","post_id",function(){g.start(e,"term","term_id",!1)})}),a.data("open")&&a.trigger("click"))}var c=new YoastSEO.Jed({domain:"js-text-analysis",locale_data:{"js-text-analysis":{"":{}}}}),d=parseInt(wpseoRecalculateL10n.posts,10),e=parseInt(wpseoRecalculateL10n.terms,10),f=function(a){this.total_count=a,this.oncomplete=!1,jQuery("#wpseo_progressbar").progressbar({value:0})};f.prototype.start=function(a,b,c,d){this.fetch_type=b,this.items_to_fetch=a,this.id_field=c,this.oncomplete=d,this.getItemsToRecalculate(1)},f.prototype.updateProgressBar=function(a){var b=jQuery("#wpseo_count").text(),c=parseInt(b,10)+a,d=c*(100/this.total_count);jQuery("#wpseo_progressbar").progressbar("value",d),this.updateCountElement(c)},f.prototype.updateCountElement=function(a){jQuery("#wpseo_count").html(a)},f.prototype.calculateScores=function(a,b){for(var c=[],d=0;a>d;d++)c.push(this.getScore(b[d]));return c},f.prototype.getScore=function(a){return{item_id:this.getItemID(a),taxonomy:a.taxonomy?a.taxonomy:"",score:this.calculateItemScore(a)}},f.prototype.getItemID=function(a){return this.items_to_fetch--,a[this.id_field]},f.prototype.calculateItemScore=function(a){a.i18n=c,a.locale=wpseoAdminL10n.locale;var b=new YoastSEO.Analyzer(a);return b.runQueue(),b.analyzeScorer.__totalScore},f.prototype.parseResponse=function(a){if(""!==a&&null!==a){if(void 0!==a.total_items){var b=this.calculateScores(a.total_items,a.items);this.sendScores(b),this.updateProgressBar(a.total_items)}return void 0!==a.next_page?this.getItemsToRecalculate(a.next_page):this.onCompleteRequest(),!0}this.onCompleteRequest()},f.prototype.onCompleteRequest=function(){this.oncomplete!==!1&&(this.oncomplete(),this.oncomplete=!1)},f.prototype.sendScores=function(a){jQuery.post(ajaxurl,{action:"wpseo_update_score",nonce:jQuery("#wpseo_recalculate_nonce").val(),scores:a,type:this.fetch_type})},f.prototype.getItemsToRecalculate=function(a){jQuery.post(ajaxurl,{action:"wpseo_recalculate_scores",nonce:jQuery("#wpseo_recalculate_nonce").val(),paged:a,type:this.fetch_type},this.parseResponse.bind(this),"json")};var g=new f(d+e);a(b)}(jQuery);