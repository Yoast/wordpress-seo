"use strict";!function(a){a.fn.wpseo_redirects=function(b){{var c=this,d=b.replace("tab-","");c.find("table")}this.encode=function(a){return encodeURIComponent(a)},this.edit_row=function(b,d){a(b).addClass("row_edit"),a(b).data("old_redirect",{key:a(b).find(".val").eq(0).html().toString(),value:a(b).find(".val").eq(1).html().toString(),type:a(b).find(".val").eq(2).html().toString()});var e=1;a.each(a(b).find(".val"),function(b,d){var f=a(d).html().toString(),g=null;a(d).hasClass("type")?(g=a("<select>").attr("tabindex",e),a.each(a(c).find("#wpseo_redirects_new_type option"),function(b,c){var d=a(c).clone();a(d).val()===f&&a(d).attr("selected","selected"),a(g).append(d)})):g=a("<input>").val(f).attr("tabindex",e),a(d).empty().append(g),e++}),a(b).find(".row-actions").hide();var f=a("<form>").submit(function(a){return a.preventDefault(),c.save_redirect(b)&&c.restore_row(b),!1});a(b).find("td .val input").wrap(f),a(b).find(".row-actions").parent().append(a("<div>").addClass("edit-actions").append(a("<button>").addClass("button-primary").attr("tabindex",4).html("Save").click(function(){return c.save_redirect(b)&&c.restore_row(b),!1}))),d&&a(b).find(".edit-actions").append(a("<button>").addClass("button").attr("tabindex",5).html("Cancel").click(function(){return c.restore_row(b),!1}))},this.delete_row=function(b){a(b).fadeTo("fast",0).slideUp(function(){a(this).remove(),a.post(ajaxurl,{action:"wpseo_delete_redirect_"+d,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),redirect:{key:c.encode(a(b).find(".val").eq(0).html().toString())}},function(a){})})},this.restore_row=function(b){a(b).removeClass("row_edit"),a.each(a(b).find(".val"),function(b,c){var d=null;d=a(c).hasClass("type")?a(c).find("select option:selected").val().toString():a(c).find("input").val().toString(),a(c).empty().html(d)}),a(b).find(".edit-actions").remove(),a(b).find(".row-actions").show()},this.save_redirect=function(b){var e=a(b).find(".val").eq(0).find("input").val().toString(),f=a(b).find(".val").eq(1).find("input").val().toString(),g=a(b).find(".val").eq(2).find("select option:selected").val().toString();if(""===e)return yoast_overlay.add_message(wpseo_premium_strings.error_saving_redirect,wpseo_premium_strings.error_old_url,5),!1;if(""===f&&"410"!==g)return yoast_overlay.add_message(wpseo_premium_strings.error_saving_redirect,wpseo_premium_strings.error_new_url,5),!1;if(""===g)return yoast_overlay.add_message(wpseo_premium_strings.error_saving_redirect,wpseo_premium_strings.error_new_type,5),!1;"url"===d&&0!==e.indexOf("/")&&(e="/"+e,a(b).find(".val").eq(0).find("input").val(e));var h=c.encode(a(b).data("old_redirect").key),i=c.encode(a(b).data("old_redirect").value),j=c.encode(a(b).data("old_redirect").type);return e=c.encode(e),f=c.encode(f),g=c.encode(g),a.post(ajaxurl,{action:"wpseo_save_redirect_"+d,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_redirect:{key:h,value:i,type:j},new_redirect:{key:e,value:f,type:g}},function(a){}),!0},this.bind_row=function(b){a(b).find(".edit").click(function(){c.edit_row(b,!0)}),a(b).find(".trash").click(function(){c.delete_row(b)})},this.remove_no_items_row=function(){c.find(".no-items").remove()},this.add_redirect=function(b,e,f){if(""===b)return"url"===d?yoast_overlay.add_message(wpseo_premium_strings.error_saving_redirect,wpseo_premium_strings.error_old_url,5):yoast_overlay.add_message(wpseo_premium_strings.error_saving_redirect,wpseo_premium_strings.error_regex,5),!1;if(e===b)return yoast_overlay.add_message(wpseo_premium_strings.error_saving_redirect,wpseo_premium_strings.error_circular,5),!1;if(""===e&&"410"!==f)return yoast_overlay.add_message(wpseo_premium_strings.error_saving_redirect,wpseo_premium_strings.error_new_url,5),!1;"url"===d&&0!==b.indexOf("/")&&(b="/"+b),c.remove_no_items_row();var g=c.create_redirect_row(b,e,f);return a("form#"+d).find("#the-list").prepend(g),c.find("#wpseo_redirects_new_old").val(""),c.find("#wpseo_redirects_new_new").val(""),b=c.encode(b),e=c.encode(e),"url"===d&&"410"!==f&&c.check_url_status(e),a.post(ajaxurl,{action:"wpseo_create_redirect_"+d,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_url:b,new_url:e,type:f},function(a){}),!0},this.check_url_status=function(b){0===b.indexOf(c.encode("/"))&&(b=c.encode(window.location.protocol+"//"+window.location.host)+b),a.post(ajaxurl,{action:"wpseo_check_url",ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),url:b},function(b){var c=a.parseJSON(b);"200"!==c.reponse_code&&yoast_overlay.add_message(wpseo_premium_strings.redirect_possibly_bad,wpseo_premium_strings.redirect_not_ok+(""!==c.reponse_code?"<br/><br/><b>HTTP Code: "+c.reponse_code+"</b>":""))})},this.create_redirect_row=function(b,d,e){var f=a("<tr>").append(a("<th>").addClass("check-column").attr("role","row").append(a("<input>").attr("type","checkbox").val(b))).append(a("<td>").append(a("<div>").addClass("val").html(b)).append(a("<div>").addClass("row-actions").append(a("<span>").addClass("edit").append(a("<a>").attr("href","javascript:;").html("Edit")).append(" | ")).append(a("<span>").addClass("trash").append(a("<a>").attr("href","javascript:;").html("Delete"))))).append(a("<td>").append(a("<div>").addClass("val").html(d))).append(a("<td>").append(a("<div>").addClass("val type").html(e)));return c.bind_row(f),f},this.setup=function(){a.each(c.find("table tr"),function(a,b){c.bind_row(b)}),c.find(".wpseo-new-redirect-form a.button-primary").click(function(){return c.add_redirect(c.find("#wpseo_redirects_new_old").val(),c.find("#wpseo_redirects_new_new").val(),c.find("#wpseo_redirects_new_type").val()),!1}),c.find(".wpseo-new-redirect-form input").keypress(function(a){13===a.which&&(a.preventDefault(),c.add_redirect(c.find("#wpseo_redirects_new_old").val(),c.find("#wpseo_redirects_new_new").val(),c.find("#wpseo_redirects_new_type").val()))}),a(window).on("beforeunload",function(){return a(".row_edit").length>0?wpseo_premium_strings.unsaved_redirects:void 0}),a(c).find(".yoast_help").qtip({position:{corner:{target:"topMiddle",tooltip:"bottomLeft"}},show:{when:{event:"click"}},hide:{when:{event:"click"}},style:{tip:"bottomLeft",name:"blue"}})},c.setup()},a(window).load(function(){a.each(a(".redirect-table-tab"),function(b,c){a(c).wpseo_redirects(a(c).attr("id"))})})}(jQuery);