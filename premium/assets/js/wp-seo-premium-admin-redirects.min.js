"use strict";!function(a){function b(){c=wp.template("redirects-inline-edit"),a.each(a(".redirect-table-tab"),function(b,c){a(c).wpseo_redirects(a(c).attr("id"))})}var c,d=[410,451],e={ORIGIN:1,TARGET:2,TYPE:0},f={ENTER:13},g=function(a){this.form=a};g.prototype.getOriginField=function(){return this.form.find("input[name=wpseo_redirects_origin]")},g.prototype.getTargetField=function(){return this.form.find("input[name=wpseo_redirects_target]")},g.prototype.getTypeField=function(){return this.form.find("select[name=wpseo_redirects_type]")},g.prototype.clearErrorMessage=function(){this.form.find(".wpseo_redirect_form .form_error").remove()},g.prototype.setErrorMessage=function(a){this.form.find(".wpseo_redirect_form").prepend('<div class="form_error error"><p>'+a+"</p></div>")},g.prototype.removeRowHighlights=function(){this.form.find(".redirect_form_row").removeClass("field_error")},g.prototype.highLightRowErrors=function(a){for(var b=0;b<a.length;b++)switch(a[b]){case"origin":this.highlightRow(this.getOriginField());break;case"target":this.highlightRow(this.getTargetField());break;case"type":this.highlightRow(this.getTypeField())}},g.prototype.highlightRow=function(a){jQuery(a).closest("div.redirect_form_row").addClass("field_error")};var h=function(a,b){this.form=a,this.type=b,this.validation_error=""};h.prototype.validate=function(){return this.form.clearErrorMessage(),this.form.removeRowHighlights(),this.runValidation(this.form.getOriginField(),this.form.getTargetField(),this.form.getTypeField())===!1?(this.addValidationError(this.validation_error),!1):!0},h.prototype.runValidation=function(a,b,c){if(""===a.val())return this.form.highlightRow(a),this.setError("plain"===this.type?wpseo_premium_strings.error_old_url:wpseo_premium_strings.error_regex);if(-1===jQuery.inArray(parseInt(c.val(),10),d)){if(""===b.val())return this.form.highlightRow(b),this.setError(wpseo_premium_strings.error_new_url);if(b.val()===a.val())return this.form.highlightRow(b),this.setError(wpseo_premium_strings.error_circular)}return""===c.val()?(this.form.highlightRow(c),this.setError(wpseo_premium_strings.error_new_type)):!0},h.prototype.setError=function(a){return this.validation_error=a,!1},h.prototype.addValidationError=function(a,b){this.form.setErrorMessage(a),void 0!==b&&this.form.highLightRowErrors(b)},h.prototype.getFormValues=function(){var a={origin:this.form.getOriginField().val().toString(),target:this.form.getTargetField().val().toString(),type:this.form.getTypeField().val().toString()};return jQuery.inArray(parseInt(a.type,10),d)>-1&&(a.target=""),a};var i=function(){this.row=null,this.quick_edit_row=null};i.prototype.setup=function(b,d){this.row=b,this.quick_edit_row=a(c({origin:_.unescape(d.origin.html()),target:_.unescape(d.target.html()),type:parseInt(d.type.html(),10),suffix:a("#the-list").find("tr").index(b)}))},i.prototype.getRow=function(){return this.row},i.prototype.getForm=function(){return this.quick_edit_row},i.prototype.show=function(){this.row.addClass("hidden"),this.quick_edit_row.insertAfter(this.row).show()},i.prototype.remove=function(){this.row.removeClass("hidden"),this.quick_edit_row.remove()};var j=new i;a.fn.wpseo_redirects=function(b){var c,i=this,k=b.replace("table-",""),l=!1,m=function(){l=!1,c=null};this.get_buttons=function(b){return"default"===b?[{text:wpseo_premium_strings.button_ok,click:function(){a(this).dialog("close")}}]:[{text:wpseo_premium_strings.button_cancel,click:function(){m(),a(this).dialog("close")}},{text:wpseo_premium_strings.button_save_anyway,"class":"button-primary",click:function(){l=!0,c(),a(this).dialog("close"),m()}}]},this.row_cells=function(a){var b=a.find(".val");return{origin:b.eq(e.ORIGIN),target:b.eq(e.TARGET),type:b.eq(e.TYPE)}},this.dialog=function(b,c,d){(void 0===d||"error"===d)&&(d="default");var e=this.get_buttons(d);a("#YoastRedirectDialogText").html(c),a("#YoastRedirectDialog").dialog({title:b,width:500,draggable:!1,resizable:!1,position:{at:"center center",my:"center center",of:window},buttons:e})},this.open_dialog=function(a){this.dialog(a.title,a.message)},this.post=function(b,c){a.post(ajaxurl,b,c," json")},this.edit_row=function(b){return a("#the-list").find("#inline-edit").length>0?void this.dialog(wpseo_premium_strings.edit_redirect,wpseo_premium_strings.editing_redirect):(j.setup(b,this.row_cells(b)),j.show(),void new g(j.quick_edit_row).getTypeField().trigger("change"))},this.create_redirect_row=function(b,c,d,e){var f=["val"];e.isTargetRelative&&""!==c&&"/"!==c||f.push("remove-slashes"),e.hasTrailingSlash&&f.push("has-trailing-slash");var g=a("<tr>").append(a("<th>").addClass("check-column").attr("role","row").append(a("<input>").attr("name","wpseo_redirects_bulk_delete[]").attr("type","checkbox").val(_.escape(b)))).append(a("<td>").append(a("<div>").addClass("val type").html(_.escape(d))).append(a("<div>").addClass("row-actions").append(a("<span>").addClass("edit").append(a("<a>").attr("href","javascript:;").html("Edit")).append(" | ")).append(a("<span>").addClass("trash").append(a("<a>").attr("href","javascript:;").html("Delete"))))).append(a("<td>").addClass("column-old").append(a("<div>").addClass("val").html(_.escape(b)))).append(a("<td>").addClass("column-new").append(a("<div>").addClass(f.join(" ")).html(_.escape(c))));return g},this.handleError=function(a,b){a.addValidationError(b.message,b.fields),"warning"===b.type&&i.dialog(wpseo_premium_strings.error_saving_redirect,b.message,b.type)},this.add_redirect=function(){var b=new g(a(".wpseo-new-redirect-form")),c=new h(b,k);if(c.validate()===!1)return!1;var d=c.getFormValues();return i.post({action:"wpseo_add_redirect_"+k,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),redirect:{origin:encodeURIComponent(d.origin),target:encodeURIComponent(d.target),type:d.type},ignore_warning:l},function(d){if(d.error)return i.handleError(c,d.error),!0;b.getOriginField().val(""),b.getTargetField().val(""),i.find(".no-items").remove();var e=i.create_redirect_row(d.origin,d.target,d.type,d.info);a("form#"+k).find("#the-list").prepend(e),i.open_dialog(wpseo_premium_strings.redirect_added)}),!0},this.update_redirect=function(){var b=new g(j.getForm()),c=new h(b,k);if(c.validate()===!1)return!1;var d=c.getFormValues(),e=j.getRow(),f=this.row_cells(e);return i.post({action:"wpseo_update_redirect_"+k,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_redirect:{origin:encodeURIComponent(f.origin.html()),target:encodeURIComponent(f.target.html()),type:encodeURIComponent(f.type.html())},new_redirect:{origin:encodeURIComponent(d.origin),target:encodeURIComponent(d.target),type:encodeURIComponent(d.type)},ignore_warning:l},function(a){return a.error?(i.handleError(c,a.error),!0):(f.origin.html(_.escape(a.origin)),f.target.html(_.escape(a.target)),f.type.html(_.escape(a.type)),j.remove(),void i.open_dialog(wpseo_premium_strings.redirect_updated))}),!0},this.delete_redirect=function(b){var c=this.row_cells(b);i.post({action:"wpseo_delete_redirect_"+k,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),redirect:{origin:encodeURIComponent(c.origin.html()),target:encodeURIComponent(c.target.html()),type:encodeURIComponent(c.type.html())}},function(){b.fadeTo("fast",0).slideUp(function(){a(this).remove()}),i.open_dialog(wpseo_premium_strings.redirect_deleted)})},this.setup=function(){a("body").append('<div id="YoastRedirectDialog"><div id="YoastRedirectDialogText"></div></div>'),a(window).on("beforeunload",function(){return a("#the-list").find("#inline-edit").length>0?wpseo_premium_strings.unsaved_redirects:void 0}),a(".redirect-table-tab").on("change","select[name=wpseo_redirects_type]",function(b){var c=parseInt(a(b.target).val(),10),e=a(b.target).closest(".wpseo_redirect_form").find(".wpseo_redirect_target_holder");jQuery.inArray(c,d)>-1?a(e).hide():a(e).show()}),a(".wpseo-new-redirect-form").on("click","a.button-primary",function(){return c=function(){i.add_redirect()},i.add_redirect(),!1}).on("keypress","input",function(a){a.which===f.ENTER&&(c=function(){i.add_redirect()},a.preventDefault(),i.add_redirect())}),a(".wp-list-table").on("click",".edit",function(b){var c=a(b.target).closest("tr");i.edit_row(c)}).on("click",".trash",function(b){var c=a(b.target).closest("tr");i.delete_redirect(c)}).on("keypress","input",function(a){a.which===f.ENTER&&(c=function(){i.update_redirect()},a.preventDefault(),i.update_redirect())}).on("click",".save",function(){(c=function(){i.update_redirect()})()}).on("click",".cancel",function(){c=null,j.remove()})},i.setup()},a(b)}(jQuery);