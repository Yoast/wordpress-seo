"use strict";!function(a){function b(){a.each(a(".redirect-table-tab"),function(b,c){a(c).wpseo_redirects(a(c).attr("id"))})}var c={DELETED:410},d={ORIGIN:1,TARGET:2,TYPE:0},e=function(){this.row=null,this.quick_edit_row=null};e.prototype.Setup=function(b,c){this.row=b,this.quick_edit_row=a("#inline-edit").clone(),this.SetFormValues(c)},e.prototype.SetFormValues=function(a){this.GetTypeField().find("option[value="+a.type.html().toString()+"]").attr("selected","selected"),this.GetOriginField().val(a.origin.html().toString()),this.GetTargetField().val(a.target.html().toString())},e.prototype.GetOriginField=function(){return this.quick_edit_row.find("#wpseo_redirects_update_origin")},e.prototype.GetTargetField=function(){return this.quick_edit_row.find("#wpseo_redirects_update_new")},e.prototype.GetTypeField=function(){return this.quick_edit_row.find("#wpseo_redirects_update_type")},e.prototype.GetRow=function(){return this.row},e.prototype.GetFormValues=function(){return{origin:this.GetOriginField().val().toString(),target:this.GetTargetField().val().toString(),type:this.GetTypeField().val().toString()}},e.prototype.Show=function(){this.row.addClass("hidden"),this.quick_edit_row.insertAfter(this.row).show()},e.prototype.Remove=function(){this.row.removeClass("hidden"),this.quick_edit_row.remove()};var f=new e;a.fn.wpseo_redirects=function(b){var e,g=this,h=b.replace("table-",""),i=!1;this.get_buttons=function(b){return"default"===b?[{text:wpseo_premium_strings.button_ok,click:function(){a(this).dialog("close")}}]:[{text:wpseo_premium_strings.button_cancel,click:function(){a(this).dialog("close")}},{text:wpseo_premium_strings.button_save,"class":"button-primary",click:function(){i=!0,a(e).click(),a(this).dialog("close"),e=null,i=!1}}]},this.row_cells=function(a){var b=a.find(".val");return{origin:b.eq(d.ORIGIN),target:b.eq(d.TARGET),type:b.eq(d.TYPE)}},this.dialog=function(b,c,d){(void 0===d||"error"===d)&&(d="default");var e=this.get_buttons(d);a("#YoastRedirectDialogText").html(c),a("#YoastRedirectDialog").dialog({title:b,width:500,draggable:!1,resizable:!1,position:{at:"center top+10%",my:"center top+10%"},buttons:e})},this.post=function(b,c){a.post(ajaxurl,b,c," json")},this.handle_response=function(a,b,c){return a.error?(g.dialog(wpseo_premium_strings.error_saving_redirect,a.error.message,a.error.type),!0):(b(a),g.dialog(c.title,c.message),!0)},this.edit_row=function(b){return a("#the-list").find("#inline-edit").length>0?void this.dialog(wpseo_premium_strings.edit_redirect,wpseo_premium_strings.editing_redirect):(f.Setup(b,this.row_cells(b)),f.Show(),void f.GetTypeField().trigger("change"))},this.validate=function(a,b,c){return""===a?"plain"===h?wpseo_premium_strings.error_old_url:wpseo_premium_strings.error_regex:b===a?wpseo_premium_strings.error_circular:""===b&&"410"!==c?wpseo_premium_strings.error_new_url:""===c?wpseo_premium_strings.error_new_type:!1},this.create_redirect_row=function(b,c,d){var e=a("<tr>").append(a("<th>").addClass("check-column").attr("role","row").append(a("<input>").attr("type","checkbox").val(b))).append(a("<td>").append(a("<div>").addClass("val type").html(d)).append(a("<div>").addClass("row-actions").append(a("<span>").addClass("edit").append(a("<a>").attr("href","javascript:;").html("Edit")).append(" | ")).append(a("<span>").addClass("trash").append(a("<a>").attr("href","javascript:;").html("Delete"))))).append(a("<td>").append(a("<div>").addClass("val").html(b))).append(a("<td>").append(a("<div>").addClass("val").html(c)));return e},this.add_redirect=function(){var b=jQuery("#wpseo_redirects_new_old").val(),d=jQuery("#wpseo_redirects_new_type").val(),e=jQuery("#wpseo_redirects_new_new").val();parseInt(d,10)===c.DELETED&&(e="");var f=g.validate(b,e,d);return f?(g.dialog(wpseo_premium_strings.error_saving_redirect,f),!1):(g.post({action:"wpseo_add_redirect_"+h,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_url:encodeURIComponent(b),new_url:encodeURIComponent(e),type:d,ignore_warning:i},g.add_redirect_response),!0)},this.add_redirect_response=function(b){e=a("form.wpseo-new-redirect-form").find(".button-primary"),g.handle_response(b,function(b){jQuery("#wpseo_redirects_new_old").val(""),jQuery("#wpseo_redirects_new_new").val(""),g.find(".no-items").remove();var c=g.create_redirect_row(b.old_redirect,b.new_redirect,b.redirect_type);a("form#"+h).find("#the-list").prepend(c)},wpseo_premium_strings.redirect_added)},this.update_redirect=function(b,d){var f=this.row_cells(b);parseInt(d.type,10)===c.DELETED&&(d.target=""),e=b.find("button.button-primary");var j=g.validate(d.origin,d.target,d.type);return j?(g.dialog(wpseo_premium_strings.error_saving_redirect,j),!1):(g.post({action:"wpseo_update_redirect_"+h,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_redirect:encodeURIComponent(f.origin.html().toString()),new_redirect:{key:encodeURIComponent(d.origin),value:encodeURIComponent(d.target),type:encodeURIComponent(d.type)},ignore_warning:i},function(a){g.handle_response(a,function(){f.origin.html(a.old_redirect),f.target.html(d.target),f.type.html(d.type)},wpseo_premium_strings.redirect_updated)}),!0)},this.delete_redirect=function(b){var c=this.row_cells(b);g.post({action:"wpseo_delete_redirect_"+h,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),redirect:c.origin.html().toString()},function(c){g.handle_response(c,function(){b.fadeTo("fast",0).slideUp(function(){a(this).remove()})},wpseo_premium_strings.redirect_deleted)})},this.toggle_select=function(b,d){var e=parseInt(a(b.target).val(),10);e===c.DELETED?d.hide():d.show()},this.setup=function(){a("body").append('<div id="YoastRedirectDialog"><div id="YoastRedirectDialogText"></div></div>'),a(".wpseo-new-redirect-form").on("click","a.button-primary",function(){return g.add_redirect(),!1}).on("keypress","input",function(a){13===a.which&&(a.preventDefault(),g.add_redirect())}).on("change","#wpseo_redirects_new_type",function(b){g.toggle_select(b,a("#wpseo_redirect_new_url"))}),a(window).on("beforeunload",function(){return a("#the-list").find("#inline-edit").length>0?wpseo_premium_strings.unsaved_redirects:void 0}),a(".wp-list-table").on("click",".edit",function(b){var c=a(b.target).closest("tr");g.edit_row(c)}).on("click",".trash",function(b){var c=a(b.target).closest("tr");g.delete_redirect(c)}).on("change","select[name=wpseo_redirects_update_type]",function(b){var c=a(b.target).closest("tr").find("div.wpseo_redirect_update_url");g.toggle_select(b,c)}).on("click",".save",function(){g.update_redirect(f.GetRow(),f.GetFormValues()),f.Remove()}).on("click",".cancel",function(){f.Remove()})},g.setup()},a(b)}(jQuery);