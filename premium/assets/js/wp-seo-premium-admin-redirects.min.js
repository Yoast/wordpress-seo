"use strict";!function(a){function b(){a.each(a(".redirect-table-tab"),function(b,c){a(c).wpseo_redirects(a(c).attr("id"))})}var c={DELETED:410};a.fn.wpseo_redirects=function(b){{var d=this,e=b.replace("table-","");d.find("table")}this.dialog=function(b,c){a("#YoastRedirectDialogText").html(c),a("#YoastRedirectDialog").attr("title",b).dialog({width:500,draggable:!1,resizable:!1,position:{at:"center top+10%",my:"center top+10%"},buttons:[{text:wpseo_premium_strings.button_ok,click:function(){a(this).dialog("close")}}]})},this.post=function(b,c){a.post(ajaxurl,b,c," json")},this.handle_response=function(a,b,c){return a.error?(d.dialog(wpseo_premium_strings.error_saving_redirect,a.error),!0):(b(a),d.dialog(c.title,c.message),!0)},this.add_select_option=function(b,c,d){var e=a(b).clone();e.val()===d&&e.attr("selected","selected"),a(c).append(e)},this.add_input_field=function(b,c){var e=b+1,f=a(c).html().toString(),g=null;a(c).hasClass("type")?(g=a("<select>").attr("tabindex",e),a.each(a(d).find("#wpseo_redirects_new_type option"),function(a,b){d.add_select_option(b,g,f)})):g=a("<input>").val(f).attr("tabindex",e),a(c).empty().append(g)},this.restore_values=function(a){var b=a.find(".val"),c=a.data("old_redirect");b.eq(0).html(c.key),b.eq(1).html(c.value),b.eq(2).html(c.type)},this.edit_row=function(b){var c=function(a){return a.preventDefault(),d.update_redirect(b),!1},e=function(b,c,d,e){return a("<button>").addClass(b).attr("tabindex",c).html(d).click(e)},f=b.find(".val");b.addClass("row_edit"),b.data("old_redirect",{key:f.eq(0).html().toString(),value:f.eq(1).html().toString(),type:f.eq(2).html().toString()}),a.each(f,this.add_input_field),a(b).find(".row-actions").hide();var g=a("<form>").submit(c);a(b).find("td .val input").wrap(g);var h=a("<div>").addClass("edit-actions");h.append(e("button-primary",4,wpseo_premium_strings.button_save,c)),h.append(e("button",5,wpseo_premium_strings.button_cancel,function(){return d.restore_row(b),d.restore_values(b),!1})),a(b).find(".row-actions").parent().append(h)},this.field_to_string=function(b,c){var d="input";a(c).hasClass("type")&&(d="select option:selected");var e=a(c).find(d).val().toString();a(c).empty().html(e)},this.restore_row=function(b){b.removeClass("row_edit"),a.each(b.find(".val"),this.field_to_string),b.find(".edit-actions").remove(),b.find(".row-actions").show()},this.validate=function(a,b,c){return""===a?"url"===e?wpseo_premium_strings.error_old_url:wpseo_premium_strings.error_regex:b===a?wpseo_premium_strings.error_circular:""===b&&"410"!==c?wpseo_premium_strings.error_new_url:""===c?wpseo_premium_strings.error_new_type:!1},this.create_redirect_row=function(b,c,d){var e=a("<tr>").append(a("<th>").addClass("check-column").attr("role","row").append(a("<input>").attr("type","checkbox").val(b))).append(a("<td>").append(a("<div>").addClass("val").html(b)).append(a("<div>").addClass("row-actions").append(a("<span>").addClass("edit").append(a("<a>").attr("href","javascript:;").html("Edit")).append(" | ")).append(a("<span>").addClass("trash").append(a("<a>").attr("href","javascript:;").html("Delete"))))).append(a("<td>").append(a("<div>").addClass("val").html(c))).append(a("<td>").append(a("<div>").addClass("val type").html(d)));return e},this.add_redirect=function(){var b=jQuery("#wpseo_redirects_new_old").val(),c=jQuery("#wpseo_redirects_new_new").val(),f=jQuery("#wpseo_redirects_new_type").val(),g=d.validate(b,c,f);return g?(d.dialog(wpseo_premium_strings.error_saving_redirect,g),!1):(d.post({action:"wpseo_add_redirect_"+e,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_url:encodeURIComponent(b),new_url:encodeURIComponent(c),type:f},d.add_redirect_response),!0)},this.add_redirect_response=function(b){d.handle_response(b,function(b){jQuery("#wpseo_redirects_new_old").val(""),jQuery("#wpseo_redirects_new_new").val(""),d.find(".no-items").remove();var c=d.create_redirect_row(b.old_redirect,b.new_redirect,b.redirect_type);a("form#"+e).find("#the-list").prepend(c)},wpseo_premium_strings.redirect_added)},this.update_redirect=function(b){var c=b.find(".val"),f=c.eq(1).find("input").val().toString(),g=c.eq(2).find("input").val().toString(),h=c.eq(0).find("select option:selected").val().toString(),i=d.validate(f,g,h);return i?(d.dialog(wpseo_premium_strings.error_saving_redirect,i),!1):(d.post({action:"wpseo_update_redirect_"+e,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_redirect:encodeURIComponent(b.data("old_redirect").key),new_redirect:{key:encodeURIComponent(f),value:encodeURIComponent(g),type:encodeURIComponent(h)}},function(a){d.handle_response(a,function(){c.eq(0).find("input").val(a.old_redirect),d.restore_row(b)},wpseo_premium_strings.redirect_updated)}),!0)},this.delete_redirect=function(b){d.post({action:"wpseo_delete_redirect_"+e,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),redirect:b.find(".val").eq(1).html().toString()},function(c){d.handle_response(c,function(){b.fadeTo("fast",0).slideUp(function(){a(this).remove()})},wpseo_premium_strings.redirect_deleted)})},this.toggle_select=function(b,d){var e=parseInt(a(b.target).val(),10);e===c.DELETED?d.hide():d.show()},this.setup=function(){a("body").append('<div id="YoastRedirectDialog"><div id="YoastRedirectDialogText"></div></div>'),a(".wpseo-new-redirect-form").on("click","a.button-primary",function(){return d.add_redirect(),!1}).on("keypress","input",function(a){13===a.which&&(a.preventDefault(),d.add_redirect())}).on("change","#wpseo_redirects_new_type",function(b){d.toggle_select(b,a("#wpseo_redirect_new_url"))}),a(window).on("beforeunload",function(){return a(".row_edit").length>0?wpseo_premium_strings.unsaved_redirects:void 0}),a(".wp-list-table").on("click",".edit",function(b){var c=a(b.target).closest("tr");d.edit_row(c)}).on("click",".trash",function(b){var c=a(b.target).closest("tr");d.delete_redirect(c)}).on("change","select[tabindex=1]",function(b){var c=a(b.target).closest("tr").find("input[tabindex=3]");d.toggle_select(b,c)})},d.setup()},a(b)}(jQuery);