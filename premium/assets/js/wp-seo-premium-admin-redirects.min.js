"use strict";!function(a){function b(){a.each(a(".redirect-table-tab"),function(b,c){a(c).wpseo_redirects(a(c).attr("id"))})}var c={DELETED:410},d={ORIGIN:1,TARGET:2,TYPE:0};a.fn.wpseo_redirects=function(b){{var e=this,f=b.replace("table-","");e.find("table")}this.row_cells=function(a){var b=a.find(".val");return{origin:b.eq(d.ORIGIN),target:b.eq(d.TARGET),type:b.eq(d.TYPE)}},this.dialog=function(b,c){a("#YoastRedirectDialogText").html(c),a("#YoastRedirectDialog").attr("title",b).dialog({width:500,draggable:!1,resizable:!1,position:{at:"center top+10%",my:"center top+10%"},buttons:[{text:wpseo_premium_strings.button_ok,click:function(){a(this).dialog("close")}}]})},this.post=function(b,c){a.post(ajaxurl,b,c," json")},this.handle_response=function(a,b,c){return a.error?(e.dialog(wpseo_premium_strings.error_saving_redirect,a.error),!0):(b(a),e.dialog(c.title,c.message),!0)},this.add_select_option=function(b,c,d){var e=a(b).clone();e.val()===d&&e.attr("selected","selected"),a(c).append(e)},this.add_input_field=function(b,c){var d=b+1,f=a(c).html().toString(),g=null;a(c).hasClass("type")?(g=a("<select>").attr("tabindex",d),a.each(a(e).find("#wpseo_redirects_new_type option"),function(a,b){e.add_select_option(b,g,f)})):g=a("<input>").val(f).attr("tabindex",d),a(c).empty().append(g)},this.restore_values=function(a){var b=this.row_cells(a),c=a.data("old_redirect");b.origin.html(c.key),b.target.html(c.value),b.type.html(c.type)},this.edit_row=function(b){var c=function(a){return a.preventDefault(),e.update_redirect(b),!1},d=function(b,c,d,e){return a("<button>").addClass(b).attr("tabindex",c).html(d).click(e)},f=this.row_cells(b);b.addClass("row_edit"),b.data("old_redirect",{key:f.origin.html().toString(),value:f.target.html().toString(),type:f.type.html().toString()}),a.each(f,this.add_input_field),a(b).find(".row-actions").hide();var g=a("<form>").submit(c);a(b).find("td .val input").wrap(g);var h=a("<div>").addClass("edit-actions");h.append(d("button-primary",4,wpseo_premium_strings.button_save,c)),h.append(d("button",5,wpseo_premium_strings.button_cancel,function(){return e.restore_row(b),e.restore_values(b),!1})),a(b).find(".row-actions").parent().append(h),a(b).find("select").change()},this.field_to_string=function(b,c){var d="input";a(c).hasClass("type")&&(d="select option:selected");var e=a(c).find(d).val().toString();a(c).empty().html(e)},this.restore_row=function(b){b.removeClass("row_edit"),a.each(b.find(".val"),this.field_to_string),b.find(".edit-actions").remove(),b.find(".row-actions").show()},this.validate=function(a,b,c){return""===a?"url"===f?wpseo_premium_strings.error_old_url:wpseo_premium_strings.error_regex:b===a?wpseo_premium_strings.error_circular:""===b&&"410"!==c?wpseo_premium_strings.error_new_url:""===c?wpseo_premium_strings.error_new_type:!1},this.create_redirect_row=function(b,c,d){var e=a("<tr>").append(a("<th>").addClass("check-column").attr("role","row").append(a("<input>").attr("type","checkbox").val(b))).append(a("<td>").append(a("<div>").addClass("val type").html(d)).append(a("<div>").addClass("row-actions").append(a("<span>").addClass("edit").append(a("<a>").attr("href","javascript:;").html("Edit")).append(" | ")).append(a("<span>").addClass("trash").append(a("<a>").attr("href","javascript:;").html("Delete"))))).append(a("<td>").append(a("<div>").addClass("val").html(b))).append(a("<td>").append(a("<div>").addClass("val").html(c)));return e},this.add_redirect=function(){var b=jQuery("#wpseo_redirects_new_old").val(),d=jQuery("#wpseo_redirects_new_type").val(),g=jQuery("#wpseo_redirects_new_new").val();parseInt(d,10)===c.DELETED&&(g="");var h=e.validate(b,g,d);return h?(e.dialog(wpseo_premium_strings.error_saving_redirect,h),!1):(e.post({action:"wpseo_add_redirect_"+f,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_url:encodeURIComponent(b),new_url:encodeURIComponent(g),type:d},e.add_redirect_response),!0)},this.add_redirect_response=function(b){e.handle_response(b,function(b){jQuery("#wpseo_redirects_new_old").val(""),jQuery("#wpseo_redirects_new_new").val(""),e.find(".no-items").remove();var c=e.create_redirect_row(b.old_redirect,b.new_redirect,b.redirect_type);a("form#"+f).find("#the-list").prepend(c)},wpseo_premium_strings.redirect_added)},this.update_redirect=function(b){var d=this.row_cells(b),g=d.type.find("select option:selected").val().toString(),h=d.origin.find("input").val().toString(),i=d.target.find("input").val().toString();parseInt(g,10)===c.DELETED&&(i="");var j=e.validate(h,i,g);return j?(e.dialog(wpseo_premium_strings.error_saving_redirect,j),!1):(e.post({action:"wpseo_update_redirect_"+f,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_redirect:encodeURIComponent(b.data("old_redirect").key),new_redirect:{key:encodeURIComponent(h),value:encodeURIComponent(i),type:encodeURIComponent(g)}},function(a){e.handle_response(a,function(){d.origin.find("input").val(a.old_redirect),e.restore_row(b)},wpseo_premium_strings.redirect_updated)}),!0)},this.delete_redirect=function(b){var c=this.row_cells(b);e.post({action:"wpseo_delete_redirect_"+f,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),redirect:c.origin.html().toString()},function(c){e.handle_response(c,function(){b.fadeTo("fast",0).slideUp(function(){a(this).remove()})},wpseo_premium_strings.redirect_deleted)})},this.toggle_select=function(b,d){var e=parseInt(a(b.target).val(),10);e===c.DELETED?d.hide():d.show()},this.setup=function(){a("body").append('<div id="YoastRedirectDialog"><div id="YoastRedirectDialogText"></div></div>'),a(".wpseo-new-redirect-form").on("click","a.button-primary",function(){return e.add_redirect(),!1}).on("keypress","input",function(a){13===a.which&&(a.preventDefault(),e.add_redirect())}).on("change","#wpseo_redirects_new_type",function(b){e.toggle_select(b,a("#wpseo_redirect_new_url"))}),a(window).on("beforeunload",function(){return a(".row_edit").length>0?wpseo_premium_strings.unsaved_redirects:void 0}),a(".wp-list-table").on("click",".edit",function(b){var c=a(b.target).closest("tr");e.edit_row(c)}).on("click",".trash",function(b){var c=a(b.target).closest("tr");e.delete_redirect(c)}).on("change","select[tabindex=1]",function(b){var c=a(b.target).closest("tr").find("input[tabindex=3]");e.toggle_select(b,c)})},e.setup()},a(b)}(jQuery);