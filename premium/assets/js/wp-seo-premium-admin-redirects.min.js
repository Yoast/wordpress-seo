"use strict";!function(a){function b(){a.each(a(".redirect-table-tab"),function(b,c){a(c).wpseo_redirects(a(c).attr("id"))})}var c={DELETED:410},d={ORIGIN:1,TARGET:2,TYPE:0},e=function(a,b){this.form=a,this.type=b,this.validation_error=""};e.prototype.validate=function(){return this.clearMessage(),this.runValidation(this.getOriginField(),this.getTargetField(),this.getTypeField())===!1?(this.addValidationError(this.validation_error),!1):!0},e.prototype.runValidation=function(a,b,d){if(""===a.val())return this.setError("plain"===this.type?wpseo_premium_strings.error_old_url:wpseo_premium_strings.error_regex);if(c.DELETED!==parseInt(d.val(),10)){if(""===b.val())return this.setError(wpseo_premium_strings.error_new_url);if(b.val()===a.val())return this.setError(wpseo_premium_strings.error_circular)}return""===d.val()?this.setError(wpseo_premium_strings.error_new_type):!0},e.prototype.setError=function(a){return this.validation_error=a,!1},e.prototype.getOriginField=function(){return this.form.find("input[name=wpseo_redirects_origin]")},e.prototype.getTargetField=function(){return this.form.find("input[name=wpseo_redirects_target]")},e.prototype.getTypeField=function(){return this.form.find("select[name=wpseo_redirects_type]")},e.prototype.addValidationError=function(a){this.form.find(".wpseo_redirect_form").prepend('<div class="form_error error"><p>'+a+"</p></div>")},e.prototype.clearMessage=function(){this.form.find(".wpseo_redirect_form .form_error").remove()},e.prototype.getFormValues=function(){var a={origin:this.getOriginField().val().toString(),target:this.getTargetField().val().toString(),type:this.getTypeField().val().toString()};return parseInt(a.type,10)===c.DELETED&&(a.target=""),a};var f=function(){this.row=null,this.quick_edit_row=null};f.prototype.setup=function(b,c){this.row=b,this.quick_edit_row=a("#inline-edit").clone(),this.setFormValues(c)},f.prototype.setFormValues=function(a){this.getTypeField().find("option[value="+a.type.html().toString()+"]").attr("selected","selected"),this.getOriginField().val(a.origin.html().toString()),this.getTargetField().val(a.target.html().toString())},f.prototype.getOriginField=function(){return this.quick_edit_row.find("#wpseo_redirects_update_origin")},f.prototype.getTargetField=function(){return this.quick_edit_row.find("#wpseo_redirects_update_new")},f.prototype.getTypeField=function(){return this.quick_edit_row.find("#wpseo_redirects_update_type")},f.prototype.getRow=function(){return this.row},f.prototype.getForm=function(){return this.quick_edit_row},f.prototype.show=function(){this.row.addClass("hidden"),this.quick_edit_row.insertAfter(this.row).show()},f.prototype.hide=function(){this.row.removeClass("hidden"),this.quick_edit_row.remove()};var g=new f;a.fn.wpseo_redirects=function(b){{var f=this,h=b.replace("table-","");f.find("table")}this.row_cells=function(a){var b=a.find(".val");return{origin:b.eq(d.ORIGIN),target:b.eq(d.TARGET),type:b.eq(d.TYPE)}},this.dialog=function(b,c){a("#YoastRedirectDialogText").html(c),a("#YoastRedirectDialog").attr("title",b).dialog({width:500,draggable:!1,resizable:!1,position:{at:"center top+10%",my:"center top+10%"},buttons:[{text:wpseo_premium_strings.button_ok,click:function(){a(this).dialog("close")}}]})},this.open_dialog=function(a){this.dialog(a.title,a.message)},this.post=function(b,c){a.post(ajaxurl,b,c," json")},this.edit_row=function(b){return a("#the-list").find("#inline-edit").length>0?void this.dialog(wpseo_premium_strings.edit_redirect,wpseo_premium_strings.editing_redirect):(g.setup(b,this.row_cells(b)),g.show(),void g.getTypeField().trigger("change"))},this.create_redirect_row=function(b,c,d){var e=a("<tr>").append(a("<th>").addClass("check-column").attr("role","row").append(a("<input>").attr("type","checkbox").val(b))).append(a("<td>").append(a("<div>").addClass("val type").html(d)).append(a("<div>").addClass("row-actions").append(a("<span>").addClass("edit").append(a("<a>").attr("href","javascript:;").html("Edit")).append(" | ")).append(a("<span>").addClass("trash").append(a("<a>").attr("href","javascript:;").html("Delete"))))).append(a("<td>").append(a("<div>").addClass("val").html(b))).append(a("<td>").append(a("<div>").addClass("val").html(c)));return e},this.add_redirect=function(){var b=new e(a(".wpseo-new-redirect-form"),h);if(b.validate()===!1)return!1;var c=b.getFormValues();return f.post({action:"wpseo_add_redirect_"+h,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_url:encodeURIComponent(c.origin),new_url:encodeURIComponent(c.target),type:c.type},function(c){if(c.error)return b.addValidationError(c.error),!0;b.getOriginField().val(""),b.getTargetField().val(""),f.find(".no-items").remove();var d=f.create_redirect_row(c.old_redirect,c.new_redirect,c.redirect_type);a("form#"+h).find("#the-list").prepend(d),f.open_dialog(wpseo_premium_strings.redirect_added)}),!0},this.update_redirect=function(){var b=new e(g.getForm(),h);if(b.validate()===!1)return!1;var c=g.getRow(),d=b.getFormValues(),i=this.row_cells(c);return f.post({action:"wpseo_update_redirect_"+h,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_redirect:encodeURIComponent(i.origin.html().toString()),new_redirect:{key:encodeURIComponent(d.origin),value:encodeURIComponent(d.target),type:encodeURIComponent(d.type)}},function(a){return a.error?(b.addValidationError(a.error),!0):(i.origin.html(a.old_redirect),i.target.html(d.target),i.type.html(d.type),g.hide(),void f.open_dialog(wpseo_premium_strings.redirect_updated))}),!0},this.delete_redirect=function(b){var c=this.row_cells(b);f.post({action:"wpseo_delete_redirect_"+h,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),redirect:c.origin.html().toString()},function(){b.fadeTo("fast",0).slideUp(function(){a(this).remove()}),f.open_dialog(wpseo_premium_strings.redirect_deleted)})},this.setup=function(){a("body").append('<div id="YoastRedirectDialog"><div id="YoastRedirectDialogText"></div></div>'),a(window).on("beforeunload",function(){return a("#the-list").find("#inline-edit").length>0?wpseo_premium_strings.unsaved_redirects:void 0}),a(".redirect-table-tab").on("change","select[name=wpseo_redirects_type]",function(b){var d=parseInt(a(b.target).val(),10),e=a(b.target).closest(".wpseo_redirect_form").find(".wpseo_redirect_target_holder");d===c.DELETED?a(e).hide():a(e).show()}),a(".wpseo-new-redirect-form").on("click","a.button-primary",function(){return f.add_redirect(),!1}).on("keypress","input",function(a){13===a.which&&(a.preventDefault(),f.add_redirect())}),a(".wp-list-table").on("click",".edit",function(b){var c=a(b.target).closest("tr");f.edit_row(c)}).on("click",".trash",function(b){var c=a(b.target).closest("tr");f.delete_redirect(c)}).on("keypress","input",function(a){13===a.which&&(a.preventDefault(),f.update_redirect())}).on("click",".save",function(){f.update_redirect()}).on("click",".cancel",function(){g.hide()})},f.setup()},a(b)}(jQuery);