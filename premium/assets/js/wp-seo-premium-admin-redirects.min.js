"use strict";jQuery(function(a){a.fn.wpseo_redirects=function(b){{var c=this,d=b.replace("table-","");c.find("table")}this.dialog=function(b,c){a("#YoastRedirectDialogText").html(c),a("#YoastRedirectDialog").attr("title",b).dialog({width:500,draggable:!1,resizable:!1,position:{at:"center top+10%",my:"center top+10%"},buttons:[{text:wpseo_premium_strings.button_ok,click:function(){a(this).dialog("close")}}]})},this.post=function(b,c){a.post(ajaxurl,b,c," json")},this.handle_response=function(a,b,d){return a.error?(c.dialog(wpseo_premium_strings.error_saving_redirect,a.error),!0):(b(a),c.dialog(d.title,d.message),!0)},this.add_select_option=function(b,c,d){var e=a(b).clone();e.val()===d&&e.attr("selected","selected"),a(c).append(e)},this.add_input_field=function(b,d){var e=b+1,f=a(d).html().toString(),g=null;a(d).hasClass("type")?(g=a("<select>").attr("tabindex",e),a.each(a(c).find("#wpseo_redirects_new_type option"),function(a,b){c.add_select_option(b,g,f)})):g=a("<input>").val(f).attr("tabindex",e),a(d).empty().append(g)},this.restore_values=function(a){var b=a.find(".val"),c=a.data("old_redirect");b.eq(0).html(c.key),b.eq(1).html(c.value),b.eq(2).html(c.type)},this.edit_row=function(b){var d=function(a){return a.preventDefault(),c.update_redirect(b),!1},e=function(b,c,d,e){return a("<button>").addClass(b).attr("tabindex",c).html(d).click(e)},f=b.find(".val");b.addClass("row_edit"),b.data("old_redirect",{key:f.eq(0).html().toString(),value:f.eq(1).html().toString(),type:f.eq(2).html().toString()}),a.each(f,this.add_input_field),a(b).find(".row-actions").hide();var g=a("<form>").submit(d);a(b).find("td .val input").wrap(g);var h=a("<div>").addClass("edit-actions");h.append(e("button-primary",4,wpseo_premium_strings.button_save,d)),h.append(e("button",5,wpseo_premium_strings.button_cancel,function(){return c.restore_row(b),c.restore_values(b),!1})),a(b).find(".row-actions").parent().append(h)},this.field_to_string=function(b,c){var d="input";a(c).hasClass("type")&&(d="select option:selected");var e=a(c).find(d).val().toString();a(c).empty().html(e)},this.restore_row=function(b){b.removeClass("row_edit"),a.each(b.find(".val"),this.field_to_string),b.find(".edit-actions").remove(),b.find(".row-actions").show()},this.validate=function(a,b,c){return""===a?"url"===d?wpseo_premium_strings.error_old_url:wpseo_premium_strings.error_regex:b===a?wpseo_premium_strings.error_circular:""===b&&"410"!==c?wpseo_premium_strings.error_new_url:""===c?wpseo_premium_strings.error_new_type:!1},this.bind_row_events=function(a){a.find(".edit").click(function(){c.edit_row(a,!0)}),a.find(".trash").click(function(){c.delete_redirect(a)})},this.check_url_status=function(b){0===b.indexOf(encodeURIComponent("/"))&&(b=encodeURIComponent(window.location.protocol+"//"+window.location.host)+b),c.post({action:"wpseo_check_url",ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),url:b},function(a){"200"!==a.reponse_code&&c.dialog(wpseo_premium_strings.redirect_possibly_bad,wpseo_premium_strings.redirect_not_ok+(""!==a.reponse_code?"<br/><br/><b>HTTP Code: "+a.reponse_code+"</b>":""))})},this.create_redirect_row=function(b,d,e){var f=a("<tr>").append(a("<th>").addClass("check-column").attr("role","row").append(a("<input>").attr("type","checkbox").val(b))).append(a("<td>").append(a("<div>").addClass("val").html(b)).append(a("<div>").addClass("row-actions").append(a("<span>").addClass("edit").append(a("<a>").attr("href","javascript:;").html("Edit")).append(" | ")).append(a("<span>").addClass("trash").append(a("<a>").attr("href","javascript:;").html("Delete"))))).append(a("<td>").append(a("<div>").addClass("val").html(d))).append(a("<td>").append(a("<div>").addClass("val type").html(e)));return c.bind_row_events(f),f},this.add_redirect=function(){var b=jQuery("#wpseo_redirects_new_old").val(),e=jQuery("#wpseo_redirects_new_new").val(),f=jQuery("#wpseo_redirects_new_type").val(),g=c.validate(b,e,f);return g?(c.dialog(wpseo_premium_strings.error_saving_redirect,g),!1):("url"===d&&"410"!==f&&c.check_url_status(encodeURIComponent(e)),c.post({action:"wpseo_add_redirect_"+d,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_url:encodeURIComponent(b),new_url:encodeURIComponent(e),type:f},c.add_redirect_response),!0)},this.add_redirect_response=function(b){c.handle_response(b,function(b){jQuery("#wpseo_redirects_new_old").val(""),jQuery("#wpseo_redirects_new_new").val(""),c.find(".no-items").remove();var e=c.create_redirect_row(b.old_redirect,b.new_redirect,b.redirect_type);a("form#"+d).find("#the-list").prepend(e)},wpseo_premium_strings.redirect_added)},this.update_redirect=function(b){var e=b.find(".val"),f=e.eq(0).find("input").val().toString(),g=e.eq(1).find("input").val().toString(),h=e.eq(2).find("select option:selected").val().toString(),i=c.validate(f,g,h);return i?(c.dialog(wpseo_premium_strings.error_saving_redirect,i),!1):(c.post({action:"wpseo_update_redirect_"+d,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),old_redirect:encodeURIComponent(b.data("old_redirect").key),new_redirect:{key:encodeURIComponent(f),value:encodeURIComponent(g),type:encodeURIComponent(h)}},function(a){c.handle_response(a,function(){e.eq(0).find("input").val(a.old_redirect),c.restore_row(b)},wpseo_premium_strings.redirect_updated)}),!0)},this.delete_redirect=function(b){c.post({action:"wpseo_delete_redirect_"+d,ajax_nonce:a(".wpseo_redirects_ajax_nonce").val(),redirect:b.find(".val").eq(0).html().toString()},function(d){c.handle_response(d,function(){b.fadeTo("fast",0).slideUp(function(){a(this).remove()})},wpseo_premium_strings.redirect_deleted)})},this.setup=function(){a("body").append('<div id="YoastRedirectDialog"><div id="YoastRedirectDialogText"></div></div>'),a.each(c.find("table tr"),function(b,d){c.bind_row_events(a(d))}),c.find(".wpseo-new-redirect-form a.button-primary").click(function(){return c.add_redirect(),!1}),c.find(".wpseo-new-redirect-form input").keypress(function(a){13===a.which&&(a.preventDefault(),c.add_redirect())}),a(window).on("beforeunload",function(){return a(".row_edit").length>0?wpseo_premium_strings.unsaved_redirects:void 0})},c.setup()},a.each(a(".redirect-table-tab"),function(b,c){a(c).wpseo_redirects(a(c).attr("id"))})});